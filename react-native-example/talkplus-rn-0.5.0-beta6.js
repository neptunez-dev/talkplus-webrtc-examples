(function(T,y){typeof exports=="object"&&typeof module<"u"?y(exports):typeof define=="function"&&define.amd?define(["exports"],y):(T=typeof globalThis<"u"?globalThis:T||self,y(T.TalkPlus={}))})(this,function(T){"use strict";var Ue=Object.defineProperty;var Oe=(T,y,C)=>y in T?Ue(T,y,{enumerable:!0,configurable:!0,writable:!0,value:C}):T[y]=C;var m=(T,y,C)=>(Oe(T,typeof y!="symbol"?y+"":y,C),C);var y=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof y<"u"&&y,C={searchParams:"URLSearchParams"in y,iterable:"Symbol"in y&&"iterator"in Symbol,blob:"FileReader"in y&&"Blob"in y&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in y,arrayBuffer:"ArrayBuffer"in y};function ae(n){return n&&DataView.prototype.isPrototypeOf(n)}if(C.arrayBuffer)var oe=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],he=ArrayBuffer.isView||function(n){return n&&oe.indexOf(Object.prototype.toString.call(n))>-1};function U(n){if(typeof n!="string"&&(n=String(n)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(n)||n==="")throw new TypeError('Invalid character in header field name: "'+n+'"');return n.toLowerCase()}function W(n){return typeof n!="string"&&(n=String(n)),n}function j(n){var r={next:function(){var e=n.shift();return{done:e===void 0,value:e}}};return C.iterable&&(r[Symbol.iterator]=function(){return r}),r}function b(n){this.map={},n instanceof b?n.forEach(function(r,e){this.append(e,r)},this):Array.isArray(n)?n.forEach(function(r){this.append(r[0],r[1])},this):n&&Object.getOwnPropertyNames(n).forEach(function(r){this.append(r,n[r])},this)}b.prototype.append=function(n,r){n=U(n),r=W(r);var e=this.map[n];this.map[n]=e?e+", "+r:r},b.prototype.delete=function(n){delete this.map[U(n)]},b.prototype.get=function(n){return n=U(n),this.has(n)?this.map[n]:null},b.prototype.has=function(n){return this.map.hasOwnProperty(U(n))},b.prototype.set=function(n,r){this.map[U(n)]=W(r)},b.prototype.forEach=function(n,r){for(var e in this.map)this.map.hasOwnProperty(e)&&n.call(r,this.map[e],e,this)},b.prototype.keys=function(){var n=[];return this.forEach(function(r,e){n.push(e)}),j(n)},b.prototype.values=function(){var n=[];return this.forEach(function(r){n.push(r)}),j(n)},b.prototype.entries=function(){var n=[];return this.forEach(function(r,e){n.push([e,r])}),j(n)},C.iterable&&(b.prototype[Symbol.iterator]=b.prototype.entries);function F(n){if(n.bodyUsed)return Promise.reject(new TypeError("Already read"));n.bodyUsed=!0}function x(n){return new Promise(function(r,e){n.onload=function(){r(n.result)},n.onerror=function(){e(n.error)}})}function le(n){var r=new FileReader,e=x(r);return r.readAsArrayBuffer(n),e}function ce(n){var r=new FileReader,e=x(r);return r.readAsText(n),e}function ue(n){for(var r=new Uint8Array(n),e=new Array(r.length),t=0;t<r.length;t++)e[t]=String.fromCharCode(r[t]);return e.join("")}function H(n){if(n.slice)return n.slice(0);var r=new Uint8Array(n.byteLength);return r.set(new Uint8Array(n)),r.buffer}function G(){return this.bodyUsed=!1,this._initBody=function(n){this.bodyUsed=this.bodyUsed,this._bodyInit=n,n?typeof n=="string"?this._bodyText=n:C.blob&&Blob.prototype.isPrototypeOf(n)?this._bodyBlob=n:C.formData&&FormData.prototype.isPrototypeOf(n)?this._bodyFormData=n:C.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)?this._bodyText=n.toString():C.arrayBuffer&&C.blob&&ae(n)?(this._bodyArrayBuffer=H(n.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):C.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(n)||he(n))?this._bodyArrayBuffer=H(n):this._bodyText=n=Object.prototype.toString.call(n):this._bodyText="",this.headers.get("content-type")||(typeof n=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):C.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},C.blob&&(this.blob=function(){var n=F(this);if(n)return n;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var n=F(this);return n||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else return this.blob().then(le)}),this.text=function(){var n=F(this);if(n)return n;if(this._bodyBlob)return ce(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(ue(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},C.formData&&(this.formData=function(){return this.text().then(pe)}),this.json=function(){return this.text().then(JSON.parse)},this}var de=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function fe(n){var r=n.toUpperCase();return de.indexOf(r)>-1?r:n}function v(n,r){if(!(this instanceof v))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');r=r||{};var e=r.body;if(n instanceof v){if(n.bodyUsed)throw new TypeError("Already read");this.url=n.url,this.credentials=n.credentials,r.headers||(this.headers=new b(n.headers)),this.method=n.method,this.mode=n.mode,this.signal=n.signal,!e&&n._bodyInit!=null&&(e=n._bodyInit,n.bodyUsed=!0)}else this.url=String(n);if(this.credentials=r.credentials||this.credentials||"same-origin",(r.headers||!this.headers)&&(this.headers=new b(r.headers)),this.method=fe(r.method||this.method||"GET"),this.mode=r.mode||this.mode||null,this.signal=r.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&e)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(e),(this.method==="GET"||this.method==="HEAD")&&(r.cache==="no-store"||r.cache==="no-cache")){var t=/([?&])_=[^&]*/;if(t.test(this.url))this.url=this.url.replace(t,"$1_="+new Date().getTime());else{var s=/\?/;this.url+=(s.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}v.prototype.clone=function(){return new v(this,{body:this._bodyInit})};function pe(n){var r=new FormData;return n.trim().split("&").forEach(function(e){if(e){var t=e.split("="),s=t.shift().replace(/\+/g," "),i=t.join("=").replace(/\+/g," ");r.append(decodeURIComponent(s),decodeURIComponent(i))}}),r}function ye(n){var r=new b,e=n.replace(/\r?\n[\t ]+/g," ");return e.split("\r").map(function(t){return t.indexOf(`
`)===0?t.substr(1,t.length):t}).forEach(function(t){var s=t.split(":"),i=s.shift().trim();if(i){var a=s.join(":").trim();r.append(i,a)}}),r}G.call(v.prototype);function k(n,r){if(!(this instanceof k))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');r||(r={}),this.type="default",this.status=r.status===void 0?200:r.status,this.ok=this.status>=200&&this.status<300,this.statusText=r.statusText===void 0?"":""+r.statusText,this.headers=new b(r.headers),this.url=r.url||"",this._initBody(n)}G.call(k.prototype),k.prototype.clone=function(){return new k(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new b(this.headers),url:this.url})},k.error=function(){var n=new k(null,{status:0,statusText:""});return n.type="error",n};var ge=[301,302,303,307,308];k.redirect=function(n,r){if(ge.indexOf(r)===-1)throw new RangeError("Invalid status code");return new k(null,{status:r,headers:{location:n}})};var N=y.DOMException;try{new N}catch{N=function(r,e){this.message=r,this.name=e;var t=Error(r);this.stack=t.stack},N.prototype=Object.create(Error.prototype),N.prototype.constructor=N}function z(n,r){return new Promise(function(e,t){var s=new v(n,r);if(s.signal&&s.signal.aborted)return t(new N("Aborted","AbortError"));var i=new XMLHttpRequest;function a(){i.abort()}i.onload=function(){var u={status:i.status,statusText:i.statusText,headers:ye(i.getAllResponseHeaders()||"")};u.url="responseURL"in i?i.responseURL:u.headers.get("X-Request-URL");var f="response"in i?i.response:i.responseText;setTimeout(function(){e(new k(f,u))},0)},i.onerror=function(){setTimeout(function(){t(new TypeError("Network request failed"))},0)},i.ontimeout=function(){setTimeout(function(){t(new TypeError("Network request failed"))},0)},i.onabort=function(){setTimeout(function(){t(new N("Aborted","AbortError"))},0)};function o(u){try{return u===""&&y.location.href?y.location.href:u}catch{return u}}i.open(s.method,o(s.url),!0),s.credentials==="include"?i.withCredentials=!0:s.credentials==="omit"&&(i.withCredentials=!1),"responseType"in i&&(C.blob?i.responseType="blob":C.arrayBuffer&&s.headers.get("Content-Type")&&s.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(i.responseType="arraybuffer")),r&&typeof r.headers=="object"&&!(r.headers instanceof b)?Object.getOwnPropertyNames(r.headers).forEach(function(u){i.setRequestHeader(u,W(r.headers[u]))}):s.headers.forEach(function(u,f){i.setRequestHeader(f,u)}),s.signal&&(s.signal.addEventListener("abort",a),i.onreadystatechange=function(){i.readyState===4&&s.signal.removeEventListener("abort",a)}),i.send(typeof s._bodyInit>"u"?null:s._bodyInit)})}z.polyfill=!0,y.fetch||(y.fetch=z,y.Headers=b,y.Request=v,y.Response=k);var L={},me={get exports(){return L},set exports(n){L=n}},P=typeof Reflect=="object"?Reflect:null,K=P&&typeof P.apply=="function"?P.apply:function(r,e,t){return Function.prototype.apply.call(r,e,t)},D;P&&typeof P.ownKeys=="function"?D=P.ownKeys:Object.getOwnPropertySymbols?D=function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:D=function(r){return Object.getOwnPropertyNames(r)};function Ce(n){console&&console.warn&&console.warn(n)}var V=Number.isNaN||function(r){return r!==r};function g(){g.init.call(this)}me.exports=g,L.once=we,g.EventEmitter=g,g.prototype._events=void 0,g.prototype._eventsCount=0,g.prototype._maxListeners=void 0;var J=10;function B(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(g,"defaultMaxListeners",{enumerable:!0,get:function(){return J},set:function(n){if(typeof n!="number"||n<0||V(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");J=n}}),g.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},g.prototype.setMaxListeners=function(r){if(typeof r!="number"||r<0||V(r))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+r+".");return this._maxListeners=r,this};function X(n){return n._maxListeners===void 0?g.defaultMaxListeners:n._maxListeners}g.prototype.getMaxListeners=function(){return X(this)},g.prototype.emit=function(r){for(var e=[],t=1;t<arguments.length;t++)e.push(arguments[t]);var s=r==="error",i=this._events;if(i!==void 0)s=s&&i.error===void 0;else if(!s)return!1;if(s){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var u=i[r];if(u===void 0)return!1;if(typeof u=="function")K(u,this,e);else for(var f=u.length,p=te(u,f),t=0;t<f;++t)K(p[t],this,e);return!0};function Z(n,r,e,t){var s,i,a;if(B(e),i=n._events,i===void 0?(i=n._events=Object.create(null),n._eventsCount=0):(i.newListener!==void 0&&(n.emit("newListener",r,e.listener?e.listener:e),i=n._events),a=i[r]),a===void 0)a=i[r]=e,++n._eventsCount;else if(typeof a=="function"?a=i[r]=t?[e,a]:[a,e]:t?a.unshift(e):a.push(e),s=X(n),s>0&&a.length>s&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=n,o.type=r,o.count=a.length,Ce(o)}return n}g.prototype.addListener=function(r,e){return Z(this,r,e,!1)},g.prototype.on=g.prototype.addListener,g.prototype.prependListener=function(r,e){return Z(this,r,e,!0)};function be(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Y(n,r,e){var t={fired:!1,wrapFn:void 0,target:n,type:r,listener:e},s=be.bind(t);return s.listener=e,t.wrapFn=s,s}g.prototype.once=function(r,e){return B(e),this.on(r,Y(this,r,e)),this},g.prototype.prependOnceListener=function(r,e){return B(e),this.prependListener(r,Y(this,r,e)),this},g.prototype.removeListener=function(r,e){var t,s,i,a,o;if(B(e),s=this._events,s===void 0)return this;if(t=s[r],t===void 0)return this;if(t===e||t.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete s[r],s.removeListener&&this.emit("removeListener",r,t.listener||e));else if(typeof t!="function"){for(i=-1,a=t.length-1;a>=0;a--)if(t[a]===e||t[a].listener===e){o=t[a].listener,i=a;break}if(i<0)return this;i===0?t.shift():Te(t,i),t.length===1&&(s[r]=t[0]),s.removeListener!==void 0&&this.emit("removeListener",r,o||e)}return this},g.prototype.off=g.prototype.removeListener,g.prototype.removeAllListeners=function(r){var e,t,s;if(t=this._events,t===void 0)return this;if(t.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):t[r]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete t[r]),this;if(arguments.length===0){var i=Object.keys(t),a;for(s=0;s<i.length;++s)a=i[s],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=t[r],typeof e=="function")this.removeListener(r,e);else if(e!==void 0)for(s=e.length-1;s>=0;s--)this.removeListener(r,e[s]);return this};function Q(n,r,e){var t=n._events;if(t===void 0)return[];var s=t[r];return s===void 0?[]:typeof s=="function"?e?[s.listener||s]:[s]:e?Ae(s):te(s,s.length)}g.prototype.listeners=function(r){return Q(this,r,!0)},g.prototype.rawListeners=function(r){return Q(this,r,!1)},g.listenerCount=function(n,r){return typeof n.listenerCount=="function"?n.listenerCount(r):ee.call(n,r)},g.prototype.listenerCount=ee;function ee(n){var r=this._events;if(r!==void 0){var e=r[n];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}g.prototype.eventNames=function(){return this._eventsCount>0?D(this._events):[]};function te(n,r){for(var e=new Array(r),t=0;t<r;++t)e[t]=n[t];return e}function Te(n,r){for(;r+1<n.length;r++)n[r]=n[r+1];n.pop()}function Ae(n){for(var r=new Array(n.length),e=0;e<r.length;++e)r[e]=n[e].listener||n[e];return r}function we(n,r){return new Promise(function(e,t){function s(a){n.removeListener(r,i),t(a)}function i(){typeof n.removeListener=="function"&&n.removeListener("error",s),e([].slice.call(arguments))}ne(n,r,i,{once:!0}),r!=="error"&&Ee(n,s,{once:!0})})}function Ee(n,r,e){typeof n.on=="function"&&ne(n,"error",r,e)}function ne(n,r,e,t){if(typeof n.on=="function")t.once?n.once(r,e):n.on(r,e);else if(typeof n.addEventListener=="function")n.addEventListener(r,function s(i){t.once&&n.removeEventListener(r,s),e(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}FileReader.prototype.readAsArrayBuffer=function(n){if(this.readyState===this.LOADING)throw new Error("InvalidStateError");this._setReadyState(this.LOADING),this._result=null,this._error=null;const r=new FileReader;r.onloadend=()=>{const e=Ie(r.result.substr(37)),t=new ArrayBuffer(e.length);new Uint8Array(t).set(Array.from(e).map(i=>i.charCodeAt(0))),this._result=t,this._setReadyState(this.DONE)},r.readAsDataURL(n)};const Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Ie=(n="")=>{const r=n.replace(/=+$/,"");let e="";if(r.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let t=0,s=0,i,a=0;i=r.charAt(a++);~i&&(s=t%4?s*64+i:i,t++%4)?e+=String.fromCharCode(255&s>>(-2*t&6)):0)i=Se.indexOf(i);return e};class h{constructor(r){m(this,"appId","");if(!r)throw new Error("TalkPlus HttpClient requires appId");this.appId=r}static New(r){if(!r)throw new Error("TalkPlus HttpClient requires appId");return new h(r)}urlWithQueries(r,e={}){let t="";const s=Object.keys(e);for(let i=0;i<s.length;i++){i===0?t+="?":t+="&";const a=s[i];a&&(Array.isArray(e[a])?e[a].forEach((o,u)=>{t+=`${a}=${o}`,u!==e.length-1&&(t+="&")}):t+=`${a}=${e[a]}`)}return r+t}buildHeader({contentType:r,sessionToken:e}){return{"app-id":this.appId,"content-type":r||"",Authorization:e?`Bearer ${e}`:""}}get({sessionToken:r,url:e,queries:t}){return this.makeRequest({sessionToken:r,url:this.urlWithQueries(e,t),method:"GET"})}put({sessionToken:r,url:e,jsonData:t,formData:s}){return this.makeRequest({sessionToken:r,url:e,method:"PUT",jsonData:t,formData:s})}post({url:r,sessionToken:e,jsonData:t,formData:s}){return this.makeRequest({url:r,method:"POST",sessionToken:e,jsonData:t,formData:s})}delete({sessionToken:r,url:e,jsonData:t}){return this.makeRequest({sessionToken:r,url:e,method:"DELETE",jsonData:t})}makeRequest({sessionToken:r,url:e,method:t,jsonData:s,formData:i}){const a={method:t};if(s&&!i&&(a.body=JSON.stringify(s)),i){a.headers=this.buildHeader({sessionToken:r}),delete a.headers["content-type"];const u=new FormData;Object.keys(i).forEach(f=>{f==="data"?u.append("data",JSON.stringify(i.data)):Array.isArray(i[f])?u.append(f,i[f].join(",")):u.append(f,i[f])}),a.body=u}else a.headers=this.buildHeader({contentType:"application/json",sessionToken:r});const o=window.fetch(e,a);return new Promise((u,f)=>{o.then(p=>p.status===500?{success:!1,data:p.json()}:p.status!==200?{success:!1,data:new Error(`request failed. status: ${p.status}`)}:{success:!0,data:p.json()}).then(async p=>{if(p.success)u(p.data);else{const A=p.data&&p.data.then&&typeof p.data.then=="function";f(A?await p.data:p.data)}}).catch(p=>{console.error(p),f(p)})})}}const ke="https://api.talkplus.io",ve="wss://ws.api.talkplus.io",c="v1.4",$="0.5.0",w={LOGIN_TOKEN:`%host%/${c}/users/login/token`,LOGIN_ANONYMOUS:`%host%/${c}/users/login/anonymous`,UPDATE_USER:`%host%/${c}/users/update`,DELETE_USER:`%host%/${c}/users/delete`,REGISTER_FCM_TOKEN:`%host%/${c}/users/register/fcm`,ENABLE_PUSH_NOTIFICATION:`%host%/${c}/users/settings/push/enable`,DISABLE_PUSH_NOTIFICATION:`%host%/${c}/users/settings/push/disable`,NOTIFICATIONS:`%host%/${c}/users/notifications`,WEBSOCKET_NOTIFICATIONS:`%host%/${c}/users/ws/notifications`,LOGOUT:`%host%/${c}/users/logout`,BLOCKED:`%host%/${c}/users/blocked`,BLOCK:`%host%/${c}/users/block`,UNBLOCK:`%host%/${c}/users/unblock`},d={GET_LIST:`%host%/${c}/channels`,CREATE:`%host%/${c}/channels/create`,GET:`%host%/${c}/channels/%s`,UPDATE:`%host%/${c}/channels/%s`,DELETE:`%host%/${c}/channels/%s`,MEMBERS:`%host%/${c}/channels/%s/members`,ADD_MEMBERS:`%host%/${c}/channels/%s/members/add`,REMOVE_MEMBERS:`%host%/${c}/channels/%s/members/remove`,BANNED_USERS:`%host%/${c}/channels/%s/members/banned`,BAN_MEMBERS:`%host%/${c}/channels/%s/members/ban`,UNBAN_MEMBERS:`%host%/${c}/channels/%s/members/unban`,MUTED_MEMBERS:`%host%/${c}/channels/%s/members/muted`,MUTE_MEMBERS:`%host%/${c}/channels/%s/members/mute`,UNMUTE_MEMBERS:`%host%/${c}/channels/%s/members/unmute`,MUTED_PEERS:`%host%/${c}/channels/%s/peer/muted`,MUTE_PEERS:`%host%/${c}/channels/%s/peer/mute`,UNMUTE_PEERS:`%host%/${c}/channels/%s/peer/unmute`,CHANNEL_PRIVATE_DATA:`%host%/${c}/channels/%s/privateData`,CHANNEL_PRIVATE_TAG:`%host%/${c}/channels/%s/privateTag`,CHANNEL_MEMBER:`%host%/${c}/channels/%s/members/%s`,CHANNEL_MEMBER_INFO:`%host%/${c}/channels/%s/memberInfo`,ENABLE_CHANNEL_PUSH_NOTI:`%host%/${c}/channels/%s/push/enable`,DISABLE_CHANNEL_PUSH_NOTI:`%host%/${c}/channels/%s/push/disable`,CHANNEL_PUSH_NOTI_SETTINGS:`%host%/${c}/channels/%s/push/settings`,MARK_READ:`%host%/${c}/channels/%s/markread`,MARK_READ_ALL:`%host%/${c}/channels/markread/all`,GET_MESSAGES:`%host%/${c}/channels/%s/messages`,GET_FILE_MESSAGES:`%host%/${c}/channels/%s/messages/files`,SEND_MESSAGE:`%host%/${c}/channels/%s/messages/send`,GET_MESSAGE:`%host%/${c}/channels/%s/messages/%s`,TRANSLATE_MESSAGE:`%host%/${c}/channels/%s/messages/%s/translate`,DELETE_MESSAGE:`%host%/${c}/channels/%s/messages/%s`,ADD_MESSAGE_REACTIONS:`%host%/${c}/channels/%s/messages/%s/reactions`,DELETE_MESSAGE_REACTIONS:`%host%/${c}/channels/%s/messages/%s/reactions/%s`,FREEZE:`%host%/${c}/channels/%s/freeze`,UNFREEZE:`%host%/${c}/channels/%s/unfreeze`,HIDE:`%host%/${c}/channels/%s/hide`,SHOW:`%host%/${c}/channels/%s/show`,HIDE_ALL:`%host%/${c}/channels/hide/all`,JOIN:`%host%/${c}/channels/%s/join`,JOIN_INVITATION:`%host%/${c}/channels/%s/join/invitation`,LEAVE:`%host%/${c}/channels/%s/leave`,UNREAD_COUNT:`%host%/${c}/channels/unread/count`,TRANSFER_OWNERSHIP:`%host%/${c}/channels/%s/transfer/ownership`};function l(n){return n.replace("%host%",ke)}function Ne(n){return n.replace("%host%",ve)}class q extends L.EventEmitter{constructor(){super(...arguments);m(this,"userId","");m(this,"sessionId","");m(this,"sessionToken","");m(this,"stunServerUris",[]);m(this,"turnServerUris",[]);m(this,"turnUsername","");m(this,"turnPassword","")}clearSession(){this.userId="",this.sessionId="",this.sessionToken="",this.stunServerUris=[],this.turnServerUris=[],this.turnUsername="",this.turnPassword=""}updateSession({userId:e,sessionId:t,sessionToken:s,stunServerUris:i,turnServerUris:a,turnUsername:o,turnPassword:u}){this.userId=e,this.sessionId=t,this.sessionToken=s,this.stunServerUris=i,this.turnServerUris=a,this.turnUsername=o,this.turnPassword=u}getSessionToken(){return this.sessionToken}isLoggedIn(){return!!this.sessionToken}generateDeviceId(){return`web::${navigator.userAgent}||${new Date().getTime()}`}wrapWithCallback(e,t,s){const i=e.bind(this),a=new Promise((o,u)=>{try{return Array.isArray(t)?o(i(...t)):o(i(t))}catch(f){return u(f)}});return s&&typeof s=="function"?a.then(o=>s(null,o)).catch(async o=>o&&o.then&&typeof o.then=="function"?s(await o):s(o)):a}wrapWithCallbackLoginRequired(e,t,s){if(!this.isLoggedIn()){const i=new Promise((a,o)=>o(new Error("talkplus client: not logged in!")));if(s&&typeof s=="function"){i.then(()=>s(null)).catch(a=>{s(a)});return}return i}return this.wrapWithCallback(e,t,s)}}class _e extends q{constructor(e){super();m(this,"appId","");if(!e)throw new Error("TalkPlus Auth requires appId for initialization");this.appId=e}async loginWithTokenAsync(e,t,s){const i=t.deviceType?t.deviceType:"web",a={deviceId:`${i}_${c}_loginWithToken_${e}`,deviceType:i,sdkVersion:$,sessionRefreshTargets:s,userId:t.userId,loginToken:t.loginToken,username:t.username,profileImageUrl:t.profileImageUrl,translationTargetLanguage:t.translationTargetLanguage,data:t.data,file:t.file};let o;return a.file?o=await h.New(this.appId).post({url:l(w.LOGIN_TOKEN),formData:a}):o=await h.New(this.appId).post({url:l(w.LOGIN_TOKEN),jsonData:a}),s.forEach(u=>{u.updateSession({userId:o.user.id,sessionId:o.sessionId,sessionToken:o.sessionToken,stunServerUris:o.stunServerUris,turnServerUris:o.turnServerUris,turnUsername:o.turnUsername,turnPassword:o.turnPassword})}),o}loginWithToken(e,t,s,i){return this.wrapWithCallback(this.loginWithTokenAsync,[e,t,s],i)}async loginAnonymousAsync(e,t,s){const i=t.deviceType?t.deviceType:"web",a={deviceId:`${i}_${c}_loginAnonymous_${e}`,deviceType:i,sdkVersion:$,sessionRefreshTargets:s,userId:t.userId,username:t.username,profileImageUrl:t.profileImageUrl,translationTargetLanguage:t.translationTargetLanguage,data:t.data,file:t.file};let o;return a.file?o=await h.New(this.appId).post({url:l(w.LOGIN_ANONYMOUS),formData:a}):o=await h.New(this.appId).post({url:l(w.LOGIN_ANONYMOUS),jsonData:a}),s.forEach(u=>{u.updateSession({userId:o.user.id,sessionId:o.sessionId,sessionToken:o.sessionToken,stunServerUris:o.stunServerUris,turnServerUris:o.turnServerUris,turnUsername:o.turnUsername,turnPassword:o.turnPassword})}),o}loginAnonymous(e,t,s,i){return this.wrapWithCallback(this.loginAnonymousAsync,[e,t,s],i)}async updateUserAsync(e){return e.file?h.New(this.appId).put({sessionToken:this.getSessionToken(),url:l(w.UPDATE_USER),formData:e}):h.New(this.appId).put({sessionToken:this.getSessionToken(),url:l(w.UPDATE_USER),jsonData:e})}updateUser(e,t){return this.wrapWithCallbackLoginRequired(this.updateUserAsync,e,t)}async deleteUserAsync(){const e=await h.New(this.appId).delete({sessionToken:this.getSessionToken(),url:l(w.DELETE_USER)});return this.clearSession(),e}deleteUser(e){return this.wrapWithCallbackLoginRequired(this.deleteUserAsync,{},e)}async enablePushNotificationAsync(){return await h.New(this.appId).post({sessionToken:this.getSessionToken(),url:l(w.ENABLE_PUSH_NOTIFICATION)})}enablePushNotification(e){return this.wrapWithCallbackLoginRequired(this.enablePushNotificationAsync,{},e)}async registerFcmTokenAsync({fcmToken:e}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:l(w.REGISTER_FCM_TOKEN),jsonData:{fcmToken:e}})}registerFcmToken(e,t){return this.wrapWithCallbackLoginRequired(this.registerFcmTokenAsync,e,t)}async disablePushNotificationAsync(){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:l(w.DISABLE_PUSH_NOTIFICATION)})}disablePushNotification(e){return this.wrapWithCallbackLoginRequired(this.disablePushNotificationAsync,{},e)}async logoutAsync(){if(!this.isLoggedIn())return this.clearSession(),{};const e=await h.New(this.appId).post({sessionToken:this.getSessionToken(),url:l(w.LOGOUT)});return this.clearSession(),e}logout(e){return this.wrapWithCallback(this.logoutAsync,[],e)}async getBlockedUsersAsync({lastUserId:e}){return await h.New(this.appId).get({sessionToken:this.getSessionToken(),url:l(w.BLOCKED),queries:e?{lastUserId:e}:{}})}getBlockedUsers(e,t){return this.wrapWithCallbackLoginRequired(this.getBlockedUsersAsync,e,t)}async blockUserAsync({userId:e}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:l(w.BLOCK),jsonData:{userId:e}})}blockUser(e,t){return this.wrapWithCallbackLoginRequired(this.blockUserAsync,e,t)}async unblockUserAsync({userId:e}){return await h.New(this.appId).post({sessionToken:this.getSessionToken(),url:l(w.UNBLOCK),jsonData:{userId:e}})}unblockUser(e,t){return this.wrapWithCallbackLoginRequired(this.unblockUserAsync,e,t)}async getNotificationAsync(e){const t=await h.New(this.appId).get({sessionToken:this.getSessionToken(),url:e}),{notification:s}=t;if(["message","messageDeleted"].includes(s.type))return{type:s.type,data:{channel:s.data.channel,message:s.data.message}};if(["channelAdded","channelChanged","channelRemoved"].includes(s.type))return{type:s.type,data:{channel:s.data.channel}};if(["memberAdded","memberLeft"].includes(s.type))return{type:s.type,data:{channel:s.data.channel,users:s.data.users}};if(["memberMuted","memberUnmuted"].includes(s.type))return{type:s.type,data:{channel:s.data.channel,users:s.data.users}};throw new Error(`Unsupported TalkPlus notification type: ${s.type}`)}getNotification(e,t){return this.wrapWithCallback(this.getNotificationAsync,e,t)}}var M=(n=>(n.Public="public",n.Hidden="hidden",n.Default="default",n))(M||{}),O=(n=>(n.Name="name",n))(O||{});class Re extends q{constructor(e){super();m(this,"appId","");if(!e)throw new Error("TalkPlus Channel requires appId for initialization");this.appId=e}async getListAsync(e){const{type:t,lastChannelId:s,filter:i,query:a,members:o,limit:u,category:f,subcategory:p,isFrozen:A,privateTag:_,summarize:E,order:R}=e,S=s?{lastChannelId:s}:{};return!t||!Object.values(M).includes(t)?S.type=M.Default:S.type=t,!i||!Object.values(O).includes(i)?S.filter=O.Name:S.filter=i,typeof A<"u"&&(S.isFrozen=A),a&&(S.query=a),f&&(S.category=f),p&&(S.subcategory=p),_&&(S.privateTag=_),o&&Array.isArray(o)&&o.length&&(S.members=o),E&&(S.summarize=E),R&&(S.order=R),u&&(S.limit=u),h.New(this.appId).get({sessionToken:this.getSessionToken(),url:l(d.GET_LIST),queries:S})}async getList(e,t){return this.wrapWithCallbackLoginRequired(this.getListAsync,e,t)}async createAsync({channelId:e,name:t,type:s,invitationCode:i,members:a,reuseChannel:o,imageUrl:u,maxMemberCount:f,hideMessagesBeforeJoin:p,data:A,category:_,subcategory:E}){const R={channelId:e,name:t,type:s,invitationCode:i,members:a,reuseChannel:o,imageUrl:u,maxMemberCount:f,hideMessagesBeforeJoin:p,category:_,subcategory:E};return A&&(R.data=A),h.New(this.appId).post({sessionToken:this.getSessionToken(),url:l(d.CREATE),jsonData:R})}create({channelId:e,name:t,type:s,invitationCode:i,members:a,reuseChannel:o,imageUrl:u,maxMemberCount:f,hideMessagesBeforeJoin:p,data:A,category:_,subcategory:E},R){return this.wrapWithCallbackLoginRequired(this.createAsync,{channelId:e,name:t,type:s,invitationCode:i,members:a,reuseChannel:o,imageUrl:u,maxMemberCount:f,hideMessagesBeforeJoin:p,data:A,category:_,subcategory:E},R)}getAsync({channelId:e}){return h.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.GET),e)})}async get({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.getAsync,{channelId:e},t)}async updateAsync({channelId:e,name:t,invitationCode:s,imageUrl:i,maxMemberCount:a,hideMessagesBeforeJoin:o,data:u,category:f,subcategory:p}){const A={channelId:e,name:t,invitationCode:s,imageUrl:i,maxMemberCount:a,hideMessagesBeforeJoin:o,category:f,subcategory:p};return u&&(A.data=u),h.New(this.appId).put({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.UPDATE),e),jsonData:A})}async update({channelId:e,name:t,invitationCode:s,imageUrl:i,maxMemberCount:a,hideMessagesBeforeJoin:o,data:u,category:f,subcategory:p},A){return this.wrapWithCallbackLoginRequired(this.updateAsync,{channelId:e,name:t,invitationCode:s,imageUrl:i,maxMemberCount:a,hideMessagesBeforeJoin:o,data:u,category:f,subcategory:p},A)}async deleteAsync({channelId:e}){return h.New(this.appId).delete({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.DELETE),e)})}async delete({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.deleteAsync,{channelId:e},t)}async getChannelMembersAsync({channelId:e,lastUserId:t}){const s=t?{lastUserId:t}:{};return h.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.MEMBERS),e),queries:s})}async getChannelMembers({channelId:e,lastUserId:t},s){return this.wrapWithCallbackLoginRequired(this.getChannelMembersAsync,{channelId:e,lastUserId:t},s)}async getChannelMemberAsync({channelId:e,userId:t}){return h.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.CHANNEL_MEMBER),e,t)})}async getChannelMember({channelId:e,userId:t},s){return this.wrapWithCallbackLoginRequired(this.getChannelMemberAsync,{channelId:e,userId:t},s)}async addChannelMembersAsync({channelId:e,members:t}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.ADD_MEMBERS),e),jsonData:{members:t}})}async addChannelMembers({channelId:e,members:t},s){return this.wrapWithCallbackLoginRequired(this.addChannelMembersAsync,{channelId:e,members:t},s)}async removeChannelMembersAsync({channelId:e,members:t}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.REMOVE_MEMBERS),e),jsonData:{members:t}})}async removeChannelMembers({channelId:e,members:t},s){return this.wrapWithCallbackLoginRequired(this.removeChannelMembersAsync,{channelId:e,members:t},s)}async getBannedUsersFromChannelAsync({channelId:e,lastUserId:t}){const s=t?{lastUserId:t}:{};return h.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.BANNED_USERS),e),queries:s})}async getBannedUsersFromChannel({channelId:e,lastUserId:t},s){return this.wrapWithCallbackLoginRequired(this.getBannedUsersFromChannelAsync,{channelId:e,lastUserId:t},s)}async banUsersFromChannelAsync({channelId:e,members:t}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.BAN_MEMBERS),e),jsonData:{members:t}})}async banUsersFromChannel({channelId:e,members:t},s){return this.wrapWithCallbackLoginRequired(this.banUsersFromChannelAsync,{channelId:e,members:t},s)}async unbanUsersFromChannelAsync({channelId:e,members:t}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.UNBAN_MEMBERS),e),jsonData:{members:t}})}async unbanUsersFromChannel({channelId:e,members:t},s){return this.wrapWithCallbackLoginRequired(this.unbanUsersFromChannelAsync,{channelId:e,members:t},s)}async getMutedChannelMembersAsync({channelId:e,lastUserId:t}){const s=t?{lastUserId:t}:{};return h.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.MUTED_MEMBERS),e),queries:s})}async getMutedChannelMembers({channelId:e,lastUserId:t},s){return this.wrapWithCallbackLoginRequired(this.getMutedChannelMembersAsync,{channelId:e,lastUserId:t},s)}async muteChannelMembersAsync({channelId:e,members:t,expireInMinutes:s}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.MUTE_MEMBERS),e),jsonData:{members:t,expireInMinutes:s}})}async muteChannelMembers({channelId:e,members:t,expireInMinutes:s},i){return this.wrapWithCallbackLoginRequired(this.muteChannelMembersAsync,{channelId:e,members:t,expireInMinutes:s},i)}async unmuteChannelMembersAsync({channelId:e,members:t}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.UNMUTE_MEMBERS),e),jsonData:{members:t}})}async unmuteChannelMembers({channelId:e,members:t},s){return this.wrapWithCallbackLoginRequired(this.unmuteChannelMembersAsync,{channelId:e,members:t},s)}async getMutedPeersAsync({channelId:e,lastUserId:t}){const s=t?{lastUserId:t}:{};return h.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.MUTED_PEERS),e),queries:s})}async getMutedPeers({channelId:e,lastUserId:t},s){return this.wrapWithCallbackLoginRequired(this.getMutedPeersAsync,{channelId:e,lastUserId:t},s)}async mutePeersAsync({channelId:e,members:t,expireInMinutes:s}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.MUTE_PEERS),e),jsonData:{members:t,expireInMinutes:s}})}async mutePeers({channelId:e,members:t,expireInMinutes:s},i){return this.wrapWithCallbackLoginRequired(this.mutePeersAsync,{channelId:e,members:t,expireInMinutes:s},i)}async unmutePeersAsync({channelId:e,members:t}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.UNMUTE_PEERS),e),jsonData:{members:t}})}async unmutePeers({channelId:e,members:t},s){return this.wrapWithCallbackLoginRequired(this.unmutePeersAsync,{channelId:e,members:t},s)}async enablePushNotiAsync({channelId:e}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.ENABLE_CHANNEL_PUSH_NOTI),e)})}async enablePushNoti({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.enablePushNotiAsync,{channelId:e},t)}async disablePushNotiAsync({channelId:e}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.DISABLE_CHANNEL_PUSH_NOTI),e)})}async disablePushNoti({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.disablePushNotiAsync,{channelId:e},t)}async getChannelPushNotificationSettingsAsync({channelId:e}){return h.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.CHANNEL_PUSH_NOTI_SETTINGS),e)})}async getChannelPushNotificationSettings({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.getChannelPushNotificationSettingsAsync,{channelId:e},t)}async updateChannelPushNotificationSettingsAsync({channelId:e,aosSound:t,iosSound:s}){const i={channelId:e};return t!==null&&(i.pushNotificationSoundAos=t),s!==null&&(i.pushNotificationSoundIos=s),h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.CHANNEL_PUSH_NOTI_SETTINGS),e),jsonData:i})}async updateChannelPushNotificationSettings({channelId:e,aosSound:t,iosSound:s},i){return this.wrapWithCallbackLoginRequired(this.updateChannelPushNotificationSettingsAsync,{channelId:e,aosSound:t,iosSound:s},i)}async markChannelAsReadAsync({channelId:e}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.MARK_READ),e)})}async markChannelAsRead({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.markChannelAsReadAsync,{channelId:e},t)}async markAllChannelsAsReadAsync(){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:l(d.MARK_READ_ALL)})}async markAllChannelsAsRead(e){return this.wrapWithCallbackLoginRequired(this.markAllChannelsAsReadAsync,null,e)}async getMessageAsync({channelId:e,messageId:t,translationTargetLanguage:s}){let i={sessionToken:this.getSessionToken(),url:this.sprintf(l(d.GET_MESSAGE),e,t)};return s&&(i.queries={translationTargetLanguage:s}),h.New(this.appId).get(i)}async getMessage(e,t){return this.wrapWithCallbackLoginRequired(this.getMessageAsync,e,t)}async getMessagesAsync({channelId:e,lastMessageId:t,limit:s,order:i,translationTargetLanguage:a}){const o=t?{channelId:e,lastMessageId:t}:{channelId:e};return s&&(o.limit=s),i&&(o.order=i),a&&(o.translationTargetLanguage=a),h.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.GET_MESSAGES),e),queries:o})}async getMessages(e,t){return this.wrapWithCallbackLoginRequired(this.getMessagesAsync,e,t)}async getFileMessagesAsync({channelId:e,lastMessageId:t,limit:s,order:i,translationTargetLanguage:a}){const o=t?{lastMessageId:t,channelId:e}:{channelId:e};return s&&(o.limit=s),i&&(o.order=i),a&&(o.translationTargetLanguage=a),h.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.GET_FILE_MESSAGES),e),queries:o})}async getFileMessages(e,t){return this.wrapWithCallbackLoginRequired(this.getFileMessagesAsync,e,t)}async sendMessageAsync({channelId:e,type:t,text:s,fileUrl:i,data:a,mentions:o,translationTargetLanguages:u,file:f,parentMessageId:p}){const E={channelId:e,type:t,text:s||"",fileUrl:i||""};return a&&(E.data=a),o&&(E.mentions=o),u&&(E.translationTargetLanguages=u),p&&(E.parentMessageId=p),f?(E.file=f,h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.SEND_MESSAGE),e),formData:E})):h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.SEND_MESSAGE),e),jsonData:E})}async sendMessage({channelId:e,type:t,text:s,fileUrl:i,data:a,mentions:o,translationTargetLanguages:u,file:f,parentMessageId:p},A){return this.wrapWithCallbackLoginRequired(this.sendMessageAsync,{channelId:e,type:t,text:s,fileUrl:i,data:a,mentions:o,translationTargetLanguages:u,file:f,parentMessageId:p},A)}async translateMessageAsync({channelId:e,messageId:t,targetLanguages:s}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),jsonData:{targetLanguages:s},url:this.sprintf(l(d.TRANSLATE_MESSAGE),e,t)})}async translateMessage(e,t){return this.wrapWithCallbackLoginRequired(this.translateMessageAsync,e,t)}async deleteMessageAsync({channelId:e,messageId:t}){return h.New(this.appId).delete({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.DELETE_MESSAGE),e,t)})}async deleteMessage({channelId:e,messageId:t},s){return this.wrapWithCallbackLoginRequired(this.deleteMessageAsync,{channelId:e,messageId:t},s)}async addMessageReactionAsync({channelId:e,messageId:t,reaction:s}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.ADD_MESSAGE_REACTIONS),e,t),jsonData:{reaction:s}})}async addMessageReaction({channelId:e,messageId:t,reaction:s},i){return this.wrapWithCallbackLoginRequired(this.addMessageReactionAsync,{channelId:e,messageId:t,reaction:s},i)}async removeMessageReactionAsync({channelId:e,messageId:t,reaction:s}){return h.New(this.appId).delete({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.DELETE_MESSAGE_REACTIONS),e,t,s)})}async removeMessageReaction({channelId:e,messageId:t,reaction:s},i){return this.wrapWithCallbackLoginRequired(this.removeMessageReactionAsync,{channelId:e,messageId:t,reaction:s},i)}async updateChannelPrivateTagAsync({channelId:e,privateTag:t}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.CHANNEL_PRIVATE_TAG),e),jsonData:{privateTag:t}})}async updateChannelPrivateTag({channelId:e,privateTag:t},s){return this.wrapWithCallbackLoginRequired(this.updateChannelPrivateTagAsync,{channelId:e,privateTag:t},s)}async updateChannelPrivateDataAsync({channelId:e,privateData:t}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.CHANNEL_PRIVATE_DATA),e),jsonData:{privateData:t}})}async updateChannelPrivateData({channelId:e,privateData:t},s){return this.wrapWithCallbackLoginRequired(this.updateChannelPrivateDataAsync,{channelId:e,privateData:t},s)}async updateChannelMemberInfoAsync({channelId:e,memberInfo:t}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.CHANNEL_MEMBER_INFO),e),jsonData:{memberInfo:t}})}async updateChannelMemberInfo({channelId:e,memberInfo:t},s){return this.wrapWithCallbackLoginRequired(this.updateChannelMemberInfoAsync,{channelId:e,memberInfo:t},s)}async freezeChannelAsync({channelId:e}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.FREEZE),e)})}async freezeChannel({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.freezeChannelAsync,{channelId:e},t)}async unfreezeChannelAsync({channelId:e}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.UNFREEZE),e)})}async unfreezeChannel({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.unfreezeChannelAsync,{channelId:e},t)}async hideChannelAsync({channelId:e}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.HIDE),e)})}async hideChannel({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.hideChannelAsync,{channelId:e},t)}async showChannelAsync({channelId:e}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.SHOW),e)})}async showChannel({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.showChannelAsync,{channelId:e},t)}async hideAllChannelsAsync(){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:l(d.HIDE_ALL)})}async hideAllChannels(e){return this.wrapWithCallbackLoginRequired(this.hideAllChannelsAsync,null,e)}async joinChannelAsync({channelId:e}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.JOIN),e)})}async joinChannel({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.joinChannelAsync,{channelId:e},t)}async joinChannelByInvitationCodeAsync({channelId:e,invitationCode:t}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.JOIN_INVITATION),e),jsonData:{invitationCode:t}})}async joinChannelByInvitationCode({channelId:e,invitationCode:t},s){return this.wrapWithCallbackLoginRequired(this.joinChannelByInvitationCodeAsync,{channelId:e,invitationCode:t},s)}async leaveChannelAsync({channelId:e,deleteChannelIfEmpty:t}){const s={channelId:e,deleteChannelIfEmpty:t};return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.LEAVE),e),jsonData:s})}async leaveChannel({channelId:e,deleteChannelIfEmpty:t},s){return this.wrapWithCallbackLoginRequired(this.leaveChannelAsync,{channelId:e,deleteChannelIfEmpty:t},s)}async getUnreadCountAsync(){return h.New(this.appId).get({sessionToken:this.getSessionToken(),url:l(d.UNREAD_COUNT)})}async getUnreadCount(e){return this.wrapWithCallbackLoginRequired(this.getUnreadCountAsync,null,e)}async transferChannelOwnershipAsync({channelId:e,userId:t}){return h.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(l(d.TRANSFER_OWNERSHIP),e),jsonData:{userId:t}})}async transferChannelOwnership({channelId:e,userId:t},s){return this.wrapWithCallbackLoginRequired(this.transferChannelOwnershipAsync,{channelId:e,userId:t},s)}getMessageUnreadCount({channel:e,message:t}){if(!this.userId)throw new Error("TalkPlus user not logged in");let s=0;return(e.members||[]).forEach(i=>{this.userId!==i.id&&i.lastReadAt<t.createdAt&&s++}),s}sprintf(e,...t){let s=e;return t.forEach(i=>{s=s.replace("%s",i)}),s}}var se=(n=>(n.Private="private",n.Public="public",n.InvitationOnly="invitationOnly",n.Broadcast="broadcast",n.SuperPublic="super_public",n.SuperPrivate="super_private",n.SuperBroadcast="super_broadcast",n.Brand="brand",n))(se||{}),re=(n=>(n.Text="text",n.Hidden="hidden",n.Admin="admin",n.AdminHidden="admin_hidden",n.Custom="custom",n.Brand="brand",n))(re||{}),ie=(n=>(n.ChannelAdded="channelAdded",n.ChannelRemoved="channelRemoved",n.ChannelChanged="channelChanged",n.MemberAdded="memberAdded",n.MemberLeft="memberLeft",n.MemberMuted="memberMuted",n.MemberUnmuted="memberUnmuted",n.MemberBanned="memberBanned",n.MemberUnbanned="memberUnbanned",n.Message="message",n.MessageDeleted="messageDeleted",n))(ie||{}),I=(n=>(n.Offer="offer",n.Answer="answer",n.Candidate="candidate",n.RejectCall="rejectCall",n.EndCall="endCall",n))(I||{});const Le=3e4,Pe=1e4;class Me extends q{constructor({appId:e,disableEvents:t}){super();m(this,"appId","");m(this,"disableEvents",!1);m(this,"deviceId","");m(this,"auth");m(this,"channel");m(this,"publicChannelsEventListener");m(this,"call");m(this,"latestNotiTimestamp",0);m(this,"lastExponentialBackOffInMS",1);m(this,"wsConn");m(this,"rtcPeerConn");m(this,"rtcConstraints");m(this,"rtcMediaStreamTracks");m(this,"rtcPeerChannelId");m(this,"rtcPeerTargetUserId");m(this,"rtcPeerIncomingOffer");if(!e)throw new Error("TalkPlus Client requires appId for initialization");this.appId=e,this.deviceId=this.generateDeviceId(),this.disableEvents=t||!1,this.auth=new _e(e),this.channel=new Re(e),this.publicChannelsEventListener=new L,this.call=new L}getVersion(){return $}updateSession(e){if(this.clearSession(),super.updateSession(e),this.auth.updateSession(e),this.channel.updateSession(e),!this.disableEvents){const t={appId:this.appId,sessionId:this.sessionId,sessionToken:this.sessionToken};this.startWebSocketConn(t)}}startWebSocketConn({appId:e,sessionId:t,sessionToken:s}){let i=Ne(w.WEBSOCKET_NOTIFICATIONS);this.latestNotiTimestamp&&(i+=`?timestamp=${this.latestNotiTimestamp}`),this.wsConn=new WebSocket(i),this.wsConn.onopen=a=>{var u;const o=JSON.stringify({appId:e,sessionId:t,sessionToken:s});(u=this.wsConn)==null||u.send(o)},this.wsConn.onclose=a=>{this.lastExponentialBackOffInMS>=Le?this.lastExponentialBackOffInMS=10:this.lastExponentialBackOffInMS>1e4?this.lastExponentialBackOffInMS+=3e3:this.lastExponentialBackOffInMS+=1e3;const o={appId:this.appId,sessionId:this.sessionId,sessionToken:this.sessionToken};this.wsConn.wsConnTimer=setTimeout(()=>this.startWebSocketConn(o),this.lastExponentialBackOffInMS)},this.wsConn.onmessage=this.websocketNotificationHandler.bind(this)}websocketNotificationHandler(e){let t;try{t=JSON.parse(e.data)}catch(f){console.error(f);return}const{error:s,type:i,data:a}=t,o=i?i.toLowerCase():"";this.latestNotiTimestamp=t.timestamp;const u=Object.values(I).includes(i);try{if(s)this.handleError(t);else if(u)switch(i){case I.Candidate:this.handleWebRTCIceCandidate(a);break;case I.Offer:this.handleWebRTCOffer(a);break;case I.Answer:this.handleWebRTCAnswer(a);break;case I.RejectCall:this.handleWebRTCRejectCall();break;case I.EndCall:this.handleWebRTCEndCall();break}else a.isPublicChannelEvent?(this.publicChannelsEventListener.emit("event",a),this.publicChannelsEventListener.emit(o,a)):(this.emit("event",a),this.emit(o,a))}catch{}}handleError(e){this.call.emit("error",e)}clearSession(){super.clearSession(),this.auth.clearSession(),this.channel.clearSession(),this.wsConn&&(clearInterval(this.wsConn.wsConnTimer),this.wsConn.close()),this.resetWebRTCDetails()}getNotification(e){let t=e.talkplus;return typeof t=="string"&&(t=JSON.parse(t)),this.auth.getNotification(t.notificationLink)}loginWithToken(e,t){return e.file&&(e.profileImageUrl=void 0),this.auth.loginWithToken(this.deviceId,e,[this],t)}loginAnonymous(e,t){return e.file&&(e.profileImageUrl=void 0),this.auth.loginAnonymous(this.deviceId,e,[this],t)}updateUser(e,t){return e.file&&(e.profileImageUrl=void 0),this.auth.updateUser(e,t)}deleteUser(e){const t=this.auth.deleteUser(e);return this.clearSession(),t}registerFcmToken(e,t){return this.auth.registerFcmToken(e,t)}enablePushNotification(e){return this.auth.enablePushNotification(e)}disablePushNotification(e){return this.auth.disablePushNotification(e)}logout(e){const t=this.auth.logout(e);return this.clearSession(),t}getBlockedUsers(e,t){return this.auth.getBlockedUsers(e,t)}blockUser(e,t){return this.auth.blockUser(e,t)}unblockUser(e,t){return this.auth.unblockUser(e,t)}getChannels(e,t){return this.channel.getList(e,t)}searchChannels(e,t){const{query:s,members:i}=e;if(!s&&(!Array.isArray(i)||!i.length))throw new Error("Searching channels requires either a non-empty query or a list of member IDs to match");return e.filter=O.Name,this.channel.getList(e,t)}getHiddenChannels(e,t){return e.type=M.Hidden,this.channel.getList(e,t)}getPublicChannels(e,t){return e.type=M.Public,this.channel.getList(e,t)}createChannel(e,t){return this.channel.create(e,t)}getChannel(e,t){return this.channel.get(e,t)}updateChannel(e,t){return this.channel.update(e,t)}deleteChannel(e,t){return this.channel.delete(e,t)}getChannelMembers(e,t){return this.channel.getChannelMembers(e,t)}getChannelMember(e,t){return this.channel.getChannelMember(e,t)}addChannelMembers(e,t){return this.channel.addChannelMembers(e,t)}removeChannelMembers(e,t){return this.channel.removeChannelMembers(e,t)}getBannedUsersFromChannel(e,t){return this.channel.getBannedUsersFromChannel(e,t)}getBannedChannelUsers(e,t){return this.channel.getBannedUsersFromChannel(e,t)}banUsersFromChannel(e,t){return this.channel.banUsersFromChannel(e,t)}banChannelMembers(e,t){return this.channel.banUsersFromChannel(e,t)}unbanUsersFromChannel(e,t){return this.channel.unbanUsersFromChannel(e,t)}unbanChannelMembers(e,t){return this.channel.unbanUsersFromChannel(e,t)}getMutedChannelMembers(e,t){return this.channel.getMutedChannelMembers(e,t)}muteChannelMembers(e,t){return this.channel.muteChannelMembers(e,t)}unmuteChannelMembers(e,t){return this.channel.unmuteChannelMembers(e,t)}getMutedPeers(e,t){return this.channel.getMutedPeers(e,t)}mutePeers(e,t){return this.channel.mutePeers(e,t)}unmutePeers(e,t){return this.channel.unmutePeers(e,t)}enableChannelPushNotification(e,t){return this.channel.enablePushNoti(e,t)}disableChannelPushNotification(e,t){return this.channel.disablePushNoti(e,t)}getChannelPushNotificationSettings(e,t){return this.channel.getChannelPushNotificationSettings(e,t)}updateChannelPushNotificationSettings(e,t){return this.channel.updateChannelPushNotificationSettings(e,t)}markChannelAsRead(e,t){return this.channel.markChannelAsRead(e,t)}markAsRead(e,t){return this.channel.markChannelAsRead(e,t)}markAllChannelsAsRead(e){return this.channel.markAllChannelsAsRead(e)}markAsReadAllChannel(e){return this.channel.markAllChannelsAsRead(e)}getMessages(e,t){return this.channel.getMessages(e,t)}getFileMessages(e,t){return this.channel.getFileMessages(e,t)}sendMessage(e,t){return this.channel.sendMessage(e,t)}translateMessage(e,t){return this.channel.translateMessage(e,t)}getMessage(e,t){return this.channel.getMessage(e,t)}deleteMessage(e,t){return this.channel.deleteMessage(e,t)}addMessageReaction(e,t){return this.channel.addMessageReaction(e,t)}removeMessageReaction(e,t){return this.channel.removeMessageReaction(e,t)}updateChannelPrivateTag(e,t){return this.channel.updateChannelPrivateTag(e,t)}updateChannelPrivateData(e,t){return this.channel.updateChannelPrivateData(e,t)}updateChannelMemberInfo(e,t){return this.channel.updateChannelMemberInfo(e,t)}freezeChannel(e,t){return this.channel.freezeChannel(e,t)}unfreezeChannel(e,t){return this.channel.unfreezeChannel(e,t)}hideChannel(e,t){return this.channel.hideChannel(e,t)}showChannel(e,t){return this.channel.showChannel(e,t)}hideAllChannels(e){return this.channel.hideAllChannels(e)}joinChannel(e,t){return this.channel.joinChannel(e,t)}joinChannelByInvitationCode(e,t){return this.channel.joinChannelByInvitationCode(e,t)}leaveChannel(e,t){return this.channel.leaveChannel(e,t)}getUnreadCount(e){return this.channel.getUnreadCount(e)}transferChannelOwnership(e,t){return this.channel.transferChannelOwnership(e,t)}getMessageUnreadCount(e){return this.channel.getMessageUnreadCount(e)}setMediaContraints(e){this.rtcConstraints=e}async makeCall(e){this.rtcPeerChannelId=e.channelId,this.rtcPeerTargetUserId=e.targetUserId,e.constraints&&this.setMediaContraints(e.constraints),this.createRtcPeerConn(),await this.addTracksFromMediaStream(),this.__makeOffer(),this.call.callCancelTimer=setTimeout(()=>this.rejectCall(),Pe)}__makeOffer(){var s;const e=this.wsConn,t=this.rtcPeerConn;(s=this.rtcPeerConn)==null||s.createOffer({iceRestart:!0,offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(i=>{t==null||t.setLocalDescription(i).then(()=>{const a=JSON.stringify({type:I.Offer,channelId:this.rtcPeerChannelId,targetUserId:this.rtcPeerTargetUserId,payload:i});this.__sendWs(e,a)}).catch(a=>{})}).catch(i=>{console.error(i)})}async addTracksFromMediaStream(){var s;let e;this.rtcConstraints?e=await navigator.mediaDevices.getUserMedia(this.rtcConstraints):e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});const t=e==null?void 0:e.getTracks();if(t.length&&!(!this.rtcPeerConn||this.rtcPeerConn.connectionState==="closed"))for(const i of t)(s=this.rtcPeerConn)==null||s.addTrack(i,e)}createRtcPeerConn(){const e=[];for(const t of this.stunServerUris)e.push({urls:t});for(const t of this.turnServerUris)e.push({urls:t,username:this.turnUsername,credential:this.turnPassword});this.rtcPeerConn=new RTCPeerConnection({iceServers:e}),!(!this.rtcPeerChannelId||!this.rtcPeerTargetUserId)&&(this.rtcPeerConn.onnegotiationneeded=t=>{this.rtcPeerIncomingOffer||this.__makeOffer()},this.rtcPeerConn.onicecandidate=t=>{if(!t.candidate)return;const s=JSON.stringify({type:I.Candidate,channelId:this.rtcPeerChannelId,targetUserId:this.rtcPeerTargetUserId,payload:t.candidate});this.__sendWs(this.wsConn,s)},this.rtcPeerConn.onconnectionstatechange=t=>{var s,i;this.call.emit("statechanged",(s=t.currentTarget)==null?void 0:s.connectionState),((i=t.currentTarget)==null?void 0:i.connectionState)==="disconnected"&&this.call.emit("disconnected")},this.rtcPeerConn.ontrack=t=>{this.call.emit("connected",t)})}handleWebRTCIceCandidate(e){var i;const t=e.webRtc.payload;if(!this.rtcPeerConn){console.error("rtc peer conn not available");return}const s=new RTCIceCandidate(t);(i=this.rtcPeerConn)==null||i.addIceCandidate(s).then(()=>{}).catch(a=>{})}handleWebRTCOffer(e){const{channelId:t,senderId:s}=e.webRtc;this.rtcPeerChannelId=t,this.rtcPeerTargetUserId=s,this.rtcPeerIncomingOffer=e,this.createRtcPeerConn(),this.call.emit("incoming",{channelId:t,userId:s})}async acceptCall(e){var t;if(e&&this.setMediaContraints(e),await this.addTracksFromMediaStream(),!this.rtcPeerIncomingOffer){console.error("TalkPlus client. no offer found"),this.handleWebRTCEndCall();return}(t=this.rtcPeerConn)==null||t.setRemoteDescription(new RTCSessionDescription(this.rtcPeerIncomingOffer.webRtc.payload)).then(()=>{}).catch(s=>{}),await this.sendAnswer()}async sendAnswer(){var s,i;const e=await((s=this.rtcPeerConn)==null?void 0:s.createAnswer());if(!e){console.error("TalkPlus client. unable to create peer answer");return}(i=this.rtcPeerConn)==null||i.setLocalDescription(new RTCSessionDescription(e)).catch(a=>{console.error(a)});const t=JSON.stringify({type:I.Answer,channelId:this.rtcPeerChannelId,targetUserId:this.rtcPeerTargetUserId,payload:e});this.__sendWs(this.wsConn,t)}endCall(){if(this.rtcPeerChannelId&&this.rtcPeerTargetUserId){const e=JSON.stringify({type:I.EndCall,channelId:this.rtcPeerChannelId,targetUserId:this.rtcPeerTargetUserId});this.__sendWs(this.wsConn,e)}this.handleWebRTCEndCall()}rejectCall(){if(this.rtcPeerChannelId&&this.rtcPeerTargetUserId){const e=JSON.stringify({type:I.RejectCall,channelId:this.rtcPeerChannelId,targetUserId:this.rtcPeerTargetUserId});this.__sendWs(this.wsConn,e)}this.handleWebRTCEndCall()}__sendWs(e,t){try{e==null||e.send(t)}catch{}}handleWebRTCAnswer(e){var s;this.call&&clearInterval(this.call.callCancelTimer);const t=e.webRtc.payload;(s=this.rtcPeerConn)==null||s.setRemoteDescription(new RTCSessionDescription(t)).then(()=>{})}handleWebRTCRejectCall(){this.call.emit("rejected",{channelId:this.rtcPeerChannelId,userId:this.rtcPeerTargetUserId}),this.resetWebRTCDetails()}handleWebRTCEndCall(){this.rtcPeerChannelId&&this.rtcPeerTargetUserId&&(this.call.emit("disconnected",{channelId:this.rtcPeerChannelId,userId:this.rtcPeerTargetUserId}),this.resetWebRTCDetails())}resetWebRTCDetails(){var e;(e=this.rtcPeerConn)==null||e.close(),this.rtcConstraints=void 0,this.rtcMediaStreamTracks=void 0,this.rtcPeerChannelId=void 0,this.rtcPeerTargetUserId=void 0,this.rtcPeerIncomingOffer=void 0,this.call&&clearInterval(this.call.callCancelTimer)}}T.ChannelQueryFilterEnum=O,T.ChannelQueryTypeEnum=M,T.ChannelTypeEnum=se,T.Client=Me,T.EventTypeEnum=ie,T.MessageTypeEnum=re,T.WebRTCEventTypeEnum=I,Object.defineProperty(T,Symbol.toStringTag,{value:"Module"})});
