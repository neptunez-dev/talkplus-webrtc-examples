(function(I,g){typeof exports=="object"&&typeof module<"u"?g(exports):typeof define=="function"&&define.amd?define(["exports"],g):(I=typeof globalThis<"u"?globalThis:I||self,g(I.TalkPlus={}))})(this,function(I){"use strict";var ze=Object.defineProperty;var Je=(I,g,A)=>g in I?ze(I,g,{enumerable:!0,configurable:!0,writable:!0,value:A}):I[g]=A;var C=(I,g,A)=>(Je(I,typeof g!="symbol"?g+"":g,A),A);var g=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{},A={searchParams:"URLSearchParams"in g,iterable:"Symbol"in g&&"iterator"in Symbol,blob:"FileReader"in g&&"Blob"in g&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in g,arrayBuffer:"ArrayBuffer"in g};function me(n){return n&&DataView.prototype.isPrototypeOf(n)}if(A.arrayBuffer)var be=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Ae=ArrayBuffer.isView||function(n){return n&&be.indexOf(Object.prototype.toString.call(n))>-1};function W(n){if(typeof n!="string"&&(n=String(n)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(n)||n==="")throw new TypeError('Invalid character in header field name: "'+n+'"');return n.toLowerCase()}function K(n){return typeof n!="string"&&(n=String(n)),n}function z(n){var r={next:function(){var e=n.shift();return{done:e===void 0,value:e}}};return A.iterable&&(r[Symbol.iterator]=function(){return r}),r}function w(n){this.map={},n instanceof w?n.forEach(function(r,e){this.append(e,r)},this):Array.isArray(n)?n.forEach(function(r){if(r.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+r.length);this.append(r[0],r[1])},this):n&&Object.getOwnPropertyNames(n).forEach(function(r){this.append(r,n[r])},this)}w.prototype.append=function(n,r){n=W(n),r=K(r);var e=this.map[n];this.map[n]=e?e+", "+r:r},w.prototype.delete=function(n){delete this.map[W(n)]},w.prototype.get=function(n){return n=W(n),this.has(n)?this.map[n]:null},w.prototype.has=function(n){return this.map.hasOwnProperty(W(n))},w.prototype.set=function(n,r){this.map[W(n)]=K(r)},w.prototype.forEach=function(n,r){for(var e in this.map)this.map.hasOwnProperty(e)&&n.call(r,this.map[e],e,this)},w.prototype.keys=function(){var n=[];return this.forEach(function(r,e){n.push(e)}),z(n)},w.prototype.values=function(){var n=[];return this.forEach(function(r){n.push(r)}),z(n)},w.prototype.entries=function(){var n=[];return this.forEach(function(r,e){n.push([e,r])}),z(n)},A.iterable&&(w.prototype[Symbol.iterator]=w.prototype.entries);function J(n){if(!n._noBody){if(n.bodyUsed)return Promise.reject(new TypeError("Already read"));n.bodyUsed=!0}}function Q(n){return new Promise(function(r,e){n.onload=function(){r(n.result)},n.onerror=function(){e(n.error)}})}function Ie(n){var r=new FileReader,e=Q(r);return r.readAsArrayBuffer(n),e}function we(n){var r=new FileReader,e=Q(r),t=/charset=([A-Za-z0-9_-]+)/.exec(n.type),s=t?t[1]:"utf-8";return r.readAsText(n,s),e}function Te(n){for(var r=new Uint8Array(n),e=new Array(r.length),t=0;t<r.length;t++)e[t]=String.fromCharCode(r[t]);return e.join("")}function ee(n){if(n.slice)return n.slice(0);var r=new Uint8Array(n.byteLength);return r.set(new Uint8Array(n)),r.buffer}function te(){return this.bodyUsed=!1,this._initBody=function(n){this.bodyUsed=this.bodyUsed,this._bodyInit=n,n?typeof n=="string"?this._bodyText=n:A.blob&&Blob.prototype.isPrototypeOf(n)?this._bodyBlob=n:A.formData&&FormData.prototype.isPrototypeOf(n)?this._bodyFormData=n:A.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)?this._bodyText=n.toString():A.arrayBuffer&&A.blob&&me(n)?(this._bodyArrayBuffer=ee(n.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):A.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(n)||Ae(n))?this._bodyArrayBuffer=ee(n):this._bodyText=n=Object.prototype.toString.call(n):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof n=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):A.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},A.blob&&(this.blob=function(){var n=J(this);if(n)return n;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var n=J(this);return n||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(A.blob)return this.blob().then(Ie);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var n=J(this);if(n)return n;if(this._bodyBlob)return we(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(Te(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},A.formData&&(this.formData=function(){return this.text().then(Se)}),this.json=function(){return this.text().then(JSON.parse)},this}var Ee=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function ve(n){var r=n.toUpperCase();return Ee.indexOf(r)>-1?r:n}function U(n,r){if(!(this instanceof U))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');r=r||{};var e=r.body;if(n instanceof U){if(n.bodyUsed)throw new TypeError("Already read");this.url=n.url,this.credentials=n.credentials,r.headers||(this.headers=new w(n.headers)),this.method=n.method,this.mode=n.mode,this.signal=n.signal,!e&&n._bodyInit!=null&&(e=n._bodyInit,n.bodyUsed=!0)}else this.url=String(n);if(this.credentials=r.credentials||this.credentials||"same-origin",(r.headers||!this.headers)&&(this.headers=new w(r.headers)),this.method=ve(r.method||this.method||"GET"),this.mode=r.mode||this.mode||null,this.signal=r.signal||this.signal||function(){if("AbortController"in g){var i=new AbortController;return i.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&e)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(e),(this.method==="GET"||this.method==="HEAD")&&(r.cache==="no-store"||r.cache==="no-cache")){var t=/([?&])_=[^&]*/;if(t.test(this.url))this.url=this.url.replace(t,"$1_="+new Date().getTime());else{var s=/\?/;this.url+=(s.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}U.prototype.clone=function(){return new U(this,{body:this._bodyInit})};function Se(n){var r=new FormData;return n.trim().split("&").forEach(function(e){if(e){var t=e.split("="),s=t.shift().replace(/\+/g," "),i=t.join("=").replace(/\+/g," ");r.append(decodeURIComponent(s),decodeURIComponent(i))}}),r}function ke(n){var r=new w,e=n.replace(/\r?\n[\t ]+/g," ");return e.split("\r").map(function(t){return t.indexOf(`
`)===0?t.substr(1,t.length):t}).forEach(function(t){var s=t.split(":"),i=s.shift().trim();if(i){var a=s.join(":").trim();try{r.append(i,a)}catch(o){console.warn("Response "+o.message)}}}),r}te.call(U.prototype);function N(n,r){if(!(this instanceof N))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(r||(r={}),this.type="default",this.status=r.status===void 0?200:r.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=r.statusText===void 0?"":""+r.statusText,this.headers=new w(r.headers),this.url=r.url||"",this._initBody(n)}te.call(N.prototype),N.prototype.clone=function(){return new N(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new w(this.headers),url:this.url})},N.error=function(){var n=new N(null,{status:200,statusText:""});return n.ok=!1,n.status=0,n.type="error",n};var Pe=[301,302,303,307,308];N.redirect=function(n,r){if(Pe.indexOf(r)===-1)throw new RangeError("Invalid status code");return new N(null,{status:r,headers:{location:n}})};var D=g.DOMException;try{new D}catch{D=function(r,e){this.message=r,this.name=e;var t=Error(r);this.stack=t.stack},D.prototype=Object.create(Error.prototype),D.prototype.constructor=D}function ne(n,r){return new Promise(function(e,t){var s=new U(n,r);if(s.signal&&s.signal.aborted)return t(new D("Aborted","AbortError"));var i=new XMLHttpRequest;function a(){i.abort()}i.onload=function(){var d={statusText:i.statusText,headers:ke(i.getAllResponseHeaders()||"")};s.url.indexOf("file://")===0&&(i.status<200||i.status>599)?d.status=200:d.status=i.status,d.url="responseURL"in i?i.responseURL:d.headers.get("X-Request-URL");var f="response"in i?i.response:i.responseText;setTimeout(function(){e(new N(f,d))},0)},i.onerror=function(){setTimeout(function(){t(new TypeError("Network request failed"))},0)},i.ontimeout=function(){setTimeout(function(){t(new TypeError("Network request timed out"))},0)},i.onabort=function(){setTimeout(function(){t(new D("Aborted","AbortError"))},0)};function o(d){try{return d===""&&g.location.href?g.location.href:d}catch{return d}}if(i.open(s.method,o(s.url),!0),s.credentials==="include"?i.withCredentials=!0:s.credentials==="omit"&&(i.withCredentials=!1),"responseType"in i&&(A.blob?i.responseType="blob":A.arrayBuffer&&(i.responseType="arraybuffer")),r&&typeof r.headers=="object"&&!(r.headers instanceof w||g.Headers&&r.headers instanceof g.Headers)){var h=[];Object.getOwnPropertyNames(r.headers).forEach(function(d){h.push(W(d)),i.setRequestHeader(d,K(r.headers[d]))}),s.headers.forEach(function(d,f){h.indexOf(f)===-1&&i.setRequestHeader(f,d)})}else s.headers.forEach(function(d,f){i.setRequestHeader(f,d)});s.signal&&(s.signal.addEventListener("abort",a),i.onreadystatechange=function(){i.readyState===4&&s.signal.removeEventListener("abort",a)}),i.send(typeof s._bodyInit>"u"?null:s._bodyInit)})}ne.polyfill=!0,g.fetch||(g.fetch=ne,g.Headers=w,g.Request=U,g.Response=N);var V=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _e(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var X={exports:{}},F=typeof Reflect=="object"?Reflect:null,se=F&&typeof F.apply=="function"?F.apply:function(r,e,t){return Function.prototype.apply.call(r,e,t)},H;F&&typeof F.ownKeys=="function"?H=F.ownKeys:Object.getOwnPropertySymbols?H=function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:H=function(r){return Object.getOwnPropertyNames(r)};function Ne(n){console&&console.warn&&console.warn(n)}var re=Number.isNaN||function(r){return r!==r};function m(){m.init.call(this)}X.exports=m,X.exports.once=Oe,m.EventEmitter=m,m.prototype._events=void 0,m.prototype._eventsCount=0,m.prototype._maxListeners=void 0;var ie=10;function q(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(m,"defaultMaxListeners",{enumerable:!0,get:function(){return ie},set:function(n){if(typeof n!="number"||n<0||re(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");ie=n}}),m.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},m.prototype.setMaxListeners=function(r){if(typeof r!="number"||r<0||re(r))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+r+".");return this._maxListeners=r,this};function ae(n){return n._maxListeners===void 0?m.defaultMaxListeners:n._maxListeners}m.prototype.getMaxListeners=function(){return ae(this)},m.prototype.emit=function(r){for(var e=[],t=1;t<arguments.length;t++)e.push(arguments[t]);var s=r==="error",i=this._events;if(i!==void 0)s=s&&i.error===void 0;else if(!s)return!1;if(s){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var h=i[r];if(h===void 0)return!1;if(typeof h=="function")se(h,this,e);else for(var d=h.length,f=ue(h,d),t=0;t<d;++t)se(f[t],this,e);return!0};function oe(n,r,e,t){var s,i,a;if(q(e),i=n._events,i===void 0?(i=n._events=Object.create(null),n._eventsCount=0):(i.newListener!==void 0&&(n.emit("newListener",r,e.listener?e.listener:e),i=n._events),a=i[r]),a===void 0)a=i[r]=e,++n._eventsCount;else if(typeof a=="function"?a=i[r]=t?[e,a]:[a,e]:t?a.unshift(e):a.push(e),s=ae(n),s>0&&a.length>s&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=n,o.type=r,o.count=a.length,Ne(o)}return n}m.prototype.addListener=function(r,e){return oe(this,r,e,!1)},m.prototype.on=m.prototype.addListener,m.prototype.prependListener=function(r,e){return oe(this,r,e,!0)};function Re(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function he(n,r,e){var t={fired:!1,wrapFn:void 0,target:n,type:r,listener:e},s=Re.bind(t);return s.listener=e,t.wrapFn=s,s}m.prototype.once=function(r,e){return q(e),this.on(r,he(this,r,e)),this},m.prototype.prependOnceListener=function(r,e){return q(e),this.prependListener(r,he(this,r,e)),this},m.prototype.removeListener=function(r,e){var t,s,i,a,o;if(q(e),s=this._events,s===void 0)return this;if(t=s[r],t===void 0)return this;if(t===e||t.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete s[r],s.removeListener&&this.emit("removeListener",r,t.listener||e));else if(typeof t!="function"){for(i=-1,a=t.length-1;a>=0;a--)if(t[a]===e||t[a].listener===e){o=t[a].listener,i=a;break}if(i<0)return this;i===0?t.shift():Me(t,i),t.length===1&&(s[r]=t[0]),s.removeListener!==void 0&&this.emit("removeListener",r,o||e)}return this},m.prototype.off=m.prototype.removeListener,m.prototype.removeAllListeners=function(r){var e,t,s;if(t=this._events,t===void 0)return this;if(t.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):t[r]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete t[r]),this;if(arguments.length===0){var i=Object.keys(t),a;for(s=0;s<i.length;++s)a=i[s],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=t[r],typeof e=="function")this.removeListener(r,e);else if(e!==void 0)for(s=e.length-1;s>=0;s--)this.removeListener(r,e[s]);return this};function le(n,r,e){var t=n._events;if(t===void 0)return[];var s=t[r];return s===void 0?[]:typeof s=="function"?e?[s.listener||s]:[s]:e?Le(s):ue(s,s.length)}m.prototype.listeners=function(r){return le(this,r,!0)},m.prototype.rawListeners=function(r){return le(this,r,!1)},m.listenerCount=function(n,r){return typeof n.listenerCount=="function"?n.listenerCount(r):ce.call(n,r)},m.prototype.listenerCount=ce;function ce(n){var r=this._events;if(r!==void 0){var e=r[n];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}m.prototype.eventNames=function(){return this._eventsCount>0?H(this._events):[]};function ue(n,r){for(var e=new Array(r),t=0;t<r;++t)e[t]=n[t];return e}function Me(n,r){for(;r+1<n.length;r++)n[r]=n[r+1];n.pop()}function Le(n){for(var r=new Array(n.length),e=0;e<r.length;++e)r[e]=n[e].listener||n[e];return r}function Oe(n,r){return new Promise(function(e,t){function s(a){n.removeListener(r,i),t(a)}function i(){typeof n.removeListener=="function"&&n.removeListener("error",s),e([].slice.call(arguments))}de(n,r,i,{once:!0}),r!=="error"&&Ue(n,s,{once:!0})})}function Ue(n,r,e){typeof n.on=="function"&&de(n,"error",r,e)}function de(n,r,e,t){if(typeof n.on=="function")t.once?n.once(r,e):n.on(r,e);else if(typeof n.addEventListener=="function")n.addEventListener(r,function s(i){t.once&&n.removeEventListener(r,s),e(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var fe=X.exports;const pe=_e(fe);FileReader.prototype.readAsArrayBuffer=function(n){if(this.readyState===this.LOADING)throw new Error("InvalidStateError");this._setReadyState(this.LOADING),this._result=null,this._error=null;const r=new FileReader;r.onloadend=()=>{const e=Be(r.result.substr(37)),t=new ArrayBuffer(e.length);new Uint8Array(t).set(Array.from(e).map(i=>i.charCodeAt(0))),this._result=t,this._setReadyState(this.DONE)},r.readAsDataURL(n)};const De="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Be=(n="")=>{const r=n.replace(/=+$/,"");let e="";if(r.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let t=0,s=0,i,a=0;i=r.charAt(a++);~i&&(s=t%4?s*64+i:i,t++%4)?e+=String.fromCharCode(255&s>>(-2*t&6)):0)i=De.indexOf(i);return e};class l{constructor(r){C(this,"appId","");if(!r)throw new Error("TalkPlus HttpClient requires appId");this.appId=r}static New(r){if(!r)throw new Error("TalkPlus HttpClient requires appId");return new l(r)}urlWithQueries(r,e={}){let t="";const s=Object.keys(e);for(let i=0;i<s.length;i++){i===0?t+="?":t+="&";const a=s[i];a&&(Array.isArray(e[a])?e[a].forEach((o,h)=>{t+=`${a}=${o}`,h!==e.length-1&&(t+="&")}):t+=`${a}=${e[a]}`)}return r+t}buildHeader({contentType:r,sessionToken:e}){return{"app-id":this.appId,"content-type":r||"",Authorization:e?`Bearer ${e}`:""}}get({sessionToken:r,url:e,queries:t}){return this.makeRequest({sessionToken:r,url:this.urlWithQueries(e,t),method:"GET"})}put({sessionToken:r,url:e,jsonData:t,formData:s}){return this.makeRequest({sessionToken:r,url:e,method:"PUT",jsonData:t,formData:s})}post({url:r,sessionToken:e,jsonData:t,formData:s}){return this.makeRequest({url:r,method:"POST",sessionToken:e,jsonData:t,formData:s})}delete({sessionToken:r,url:e,jsonData:t}){return this.makeRequest({sessionToken:r,url:e,method:"DELETE",jsonData:t})}makeRequest({sessionToken:r,url:e,method:t,jsonData:s,formData:i}){const a={method:t};if(s&&!i&&(a.body=JSON.stringify(s)),i){a.headers=this.buildHeader({sessionToken:r}),delete a.headers["content-type"];const h=new FormData;Object.keys(i).forEach(d=>{d==="data"?h.append("data",JSON.stringify(i.data)):Array.isArray(i[d])?h.append(d,i[d].join(",")):h.append(d,i[d])}),a.body=h}else a.headers=this.buildHeader({contentType:"application/json",sessionToken:r});const o=window.fetch(e,a);return new Promise((h,d)=>{o.then(f=>f.status===500?{success:!1,data:f.json()}:f.status!==200?{success:!1,data:new Error(`request failed. status: ${f.status}`)}:{success:!0,data:f.json()}).then(async f=>{if(f.success)h(f.data);else{const T=f.data&&f.data.then&&typeof f.data.then=="function";d(T?await f.data:f.data)}}).catch(f=>{console.error(f),d(f)})})}}const We="https://api.talkplus.io",Fe="wss://ws.api.talkplus.io",u="v1.4",Z="0.5.3",v={LOGIN_TOKEN:`%host%/${u}/users/login/token`,LOGIN_ANONYMOUS:`%host%/${u}/users/login/anonymous`,UPDATE_USER:`%host%/${u}/users/update`,DELETE_USER:`%host%/${u}/users/delete`,REGISTER_FCM_TOKEN:`%host%/${u}/users/register/fcm`,REGISTER_PUSHKIT_TOKEN:`%host%/${u}/users/register/pushkit`,ENABLE_PUSH_NOTIFICATION:`%host%/${u}/users/settings/push/enable`,DISABLE_PUSH_NOTIFICATION:`%host%/${u}/users/settings/push/disable`,NOTIFICATIONS:`%host%/${u}/users/notifications`,WEBSOCKET_NOTIFICATIONS:`%host%/${u}/users/ws/notifications`,WEBRTC_AUTH:`%host%/${u}/users/webrtc/auth`,LOGOUT:`%host%/${u}/users/logout`,BLOCKED:`%host%/${u}/users/blocked`,BLOCK:`%host%/${u}/users/block`,UNBLOCK:`%host%/${u}/users/unblock`},p={GET_LIST:`%host%/${u}/channels`,CREATE:`%host%/${u}/channels/create`,GET:`%host%/${u}/channels/%s`,UPDATE:`%host%/${u}/channels/%s`,DELETE:`%host%/${u}/channels/%s`,MEMBERS:`%host%/${u}/channels/%s/members`,ADD_MEMBERS:`%host%/${u}/channels/%s/members/add`,REMOVE_MEMBERS:`%host%/${u}/channels/%s/members/remove`,BANNED_USERS:`%host%/${u}/channels/%s/members/banned`,BAN_MEMBERS:`%host%/${u}/channels/%s/members/ban`,UNBAN_MEMBERS:`%host%/${u}/channels/%s/members/unban`,MUTED_MEMBERS:`%host%/${u}/channels/%s/members/muted`,MUTE_MEMBERS:`%host%/${u}/channels/%s/members/mute`,UNMUTE_MEMBERS:`%host%/${u}/channels/%s/members/unmute`,MUTED_PEERS:`%host%/${u}/channels/%s/peer/muted`,MUTE_PEERS:`%host%/${u}/channels/%s/peer/mute`,UNMUTE_PEERS:`%host%/${u}/channels/%s/peer/unmute`,CHANNEL_PRIVATE_DATA:`%host%/${u}/channels/%s/privateData`,CHANNEL_PRIVATE_TAG:`%host%/${u}/channels/%s/privateTag`,CHANNEL_MEMBER:`%host%/${u}/channels/%s/members/%s`,CHANNEL_MEMBER_INFO:`%host%/${u}/channels/%s/memberInfo`,ENABLE_CHANNEL_PUSH_NOTI:`%host%/${u}/channels/%s/push/enable`,DISABLE_CHANNEL_PUSH_NOTI:`%host%/${u}/channels/%s/push/disable`,CHANNEL_PUSH_NOTI_SETTINGS:`%host%/${u}/channels/%s/push/settings`,MARK_READ:`%host%/${u}/channels/%s/markread`,MARK_READ_ALL:`%host%/${u}/channels/markread/all`,GET_MESSAGES:`%host%/${u}/channels/%s/messages`,GET_FILE_MESSAGES:`%host%/${u}/channels/%s/messages/files`,SEND_MESSAGE:`%host%/${u}/channels/%s/messages/send`,GET_MESSAGE:`%host%/${u}/channels/%s/messages/%s`,TRANSLATE_MESSAGE:`%host%/${u}/channels/%s/messages/%s/translate`,DELETE_MESSAGE:`%host%/${u}/channels/%s/messages/%s`,ADD_MESSAGE_REACTIONS:`%host%/${u}/channels/%s/messages/%s/reactions`,DELETE_MESSAGE_REACTIONS:`%host%/${u}/channels/%s/messages/%s/reactions/%s`,FREEZE:`%host%/${u}/channels/%s/freeze`,UNFREEZE:`%host%/${u}/channels/%s/unfreeze`,HIDE:`%host%/${u}/channels/%s/hide`,SHOW:`%host%/${u}/channels/%s/show`,HIDE_ALL:`%host%/${u}/channels/hide/all`,JOIN:`%host%/${u}/channels/%s/join`,JOIN_INVITATION:`%host%/${u}/channels/%s/join/invitation`,LEAVE:`%host%/${u}/channels/%s/leave`,UNREAD_COUNT:`%host%/${u}/channels/unread/count`,TRANSFER_OWNERSHIP:`%host%/${u}/channels/%s/transfer/ownership`};function c(n){return n.replace("%host%",We)}function xe(n){return n.replace("%host%",Fe)}var G={exports:{}};/*! https://mths.be/base64 v1.0.0 by @mathias | MIT license */G.exports,function(n,r){(function(e){var t=r,s=n&&n.exports==t&&n,i=typeof V=="object"&&V;(i.global===i||i.window===i)&&(e=i);var a=function(y){this.message=y};a.prototype=new Error,a.prototype.name="InvalidCharacterError";var o=function(y){throw new a(y)},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=/[\t\n\f\r ]/g,f=function(y){y=String(y).replace(d,"");var b=y.length;b%4==0&&(y=y.replace(/==?$/,""),b=y.length),(b%4==1||/[^+a-zA-Z0-9/]/.test(y))&&o("Invalid character: the string to be decoded is not correctly encoded.");for(var L=0,_,O,B="",$=-1;++$<b;)O=h.indexOf(y.charAt($)),_=L%4?_*64+O:O,L++%4&&(B+=String.fromCharCode(255&_>>(-2*L&6)));return B},T=function(y){y=String(y),/[^\0-\xFF]/.test(y)&&o("The string to be encoded contains characters outside of the Latin1 range.");for(var b=y.length%3,L="",_=-1,O,B,$,P,Ke=y.length-b;++_<Ke;)O=y.charCodeAt(_)<<16,B=y.charCodeAt(++_)<<8,$=y.charCodeAt(++_),P=O+B+$,L+=h.charAt(P>>18&63)+h.charAt(P>>12&63)+h.charAt(P>>6&63)+h.charAt(P&63);return b==2?(O=y.charCodeAt(_)<<8,B=y.charCodeAt(++_),P=O+B,L+=h.charAt(P>>10)+h.charAt(P>>4&63)+h.charAt(P<<2&63)+"="):b==1&&(P=y.charCodeAt(_),L+=h.charAt(P>>2)+h.charAt(P<<4&63)+"=="),L},k={encode:T,decode:f,version:"1.0.0"};if(t&&!t.nodeType)if(s)s.exports=k;else for(var E in k)k.hasOwnProperty(E)&&(t[E]=k[E]);else e.base64=k})(V)}(G,G.exports);var je=G.exports;class Y extends fe.EventEmitter{constructor(){super(...arguments);C(this,"userId","");C(this,"sessionId","");C(this,"sessionToken","");C(this,"__isLoggedInCached",!1);C(this,"__sessionTokenExpiresAt",0)}clearSession(){this.userId="",this.sessionId="",this.sessionToken="",this.__isLoggedInCached=!1,this.__sessionTokenExpiresAt=0}updateSession({userId:e,sessionId:t,sessionToken:s}){this.userId=e,this.sessionId=t,this.sessionToken=s}getSessionToken(){return this.sessionToken}isLoggedIn(){if(!!!this.sessionToken)return!1;if(this.__sessionTokenExpiresAt>0)return this.__isLoggedInCached;const t=this.parseJwt(this.sessionToken);if(!t.exp)return!0;const s=Math.floor(Date.now()/1e3);return this.__isLoggedInCached=s<=t.exp,this.__sessionTokenExpiresAt=t.exp,this.__isLoggedInCached}generateDeviceId(){return`web::${navigator.userAgent}||${new Date().getTime()}`}wrapWithCallback(e,t,s){const i=e.bind(this),a=new Promise((o,h)=>{try{return Array.isArray(t)?o(i(...t)):o(i(t))}catch(d){return h(d)}});return s&&typeof s=="function"?a.then(o=>s(null,o)).catch(async o=>o&&o.then&&typeof o.then=="function"?s(await o):s(o)):a}wrapWithCallbackLoginRequired(e,t,s){if(!this.isLoggedIn()){const i=new Promise((a,o)=>o(new Error("talkplus client: not logged in!")));if(s&&typeof s=="function"){i.then(()=>s(null)).catch(a=>{s(a)});return}return i}return this.wrapWithCallback(e,t,s)}parseJwt(e){var a;const t=e.split(".");if(!t.length)return"";var s=(a=t[1])==null?void 0:a.replace(/-/g,"+").replace(/_/g,"/");if(!s)return"";var i=decodeURIComponent(je.decode(s).split("").map(function(o){return"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(i)}}class $e extends Y{constructor(e){super();C(this,"appId","");if(!e)throw new Error("TalkPlus Auth requires appId for initialization");this.appId=e}async loginWithTokenAsync(e,t,s){const i=t.deviceType?t.deviceType:"web",a={deviceId:`${i}_${u}_loginWithToken_${e}`,deviceType:i,sdkVersion:Z,userId:t.userId,loginToken:t.loginToken,username:t.username,profileImageUrl:t.profileImageUrl,translationTargetLanguage:t.translationTargetLanguage,data:t.data,file:t.file};let o;return a.file?o=await l.New(this.appId).post({url:c(v.LOGIN_TOKEN),formData:a}):o=await l.New(this.appId).post({url:c(v.LOGIN_TOKEN),jsonData:a}),s.forEach(h=>{h.updateSession({userId:o.user.id,sessionId:o.sessionId,sessionToken:o.sessionToken})}),o}loginWithToken(e,t,s,i){return this.wrapWithCallback(this.loginWithTokenAsync,[e,t,s],i)}async loginAnonymousAsync(e,t,s){const i=t.deviceType?t.deviceType:"web",a={deviceId:`${i}_${u}_loginAnonymous_${e}`,deviceType:i,sdkVersion:Z,userId:t.userId,username:t.username,profileImageUrl:t.profileImageUrl,translationTargetLanguage:t.translationTargetLanguage,data:t.data,file:t.file};let o;return a.file?o=await l.New(this.appId).post({url:c(v.LOGIN_ANONYMOUS),formData:a}):o=await l.New(this.appId).post({url:c(v.LOGIN_ANONYMOUS),jsonData:a}),s.forEach(h=>{h.updateSession({userId:o.user.id,sessionId:o.sessionId,sessionToken:o.sessionToken})}),o}loginAnonymous(e,t,s,i){return this.wrapWithCallback(this.loginAnonymousAsync,[e,t,s],i)}async updateUserAsync(e){return e.file?l.New(this.appId).put({sessionToken:this.getSessionToken(),url:c(v.UPDATE_USER),formData:e}):l.New(this.appId).put({sessionToken:this.getSessionToken(),url:c(v.UPDATE_USER),jsonData:e})}updateUser(e,t){return this.wrapWithCallbackLoginRequired(this.updateUserAsync,e,t)}async deleteUserAsync(){const e=await l.New(this.appId).delete({sessionToken:this.getSessionToken(),url:c(v.DELETE_USER)});return this.clearSession(),e}deleteUser(e){return this.wrapWithCallbackLoginRequired(this.deleteUserAsync,{},e)}async enablePushNotificationAsync(){return await l.New(this.appId).post({sessionToken:this.getSessionToken(),url:c(v.ENABLE_PUSH_NOTIFICATION)})}enablePushNotification(e){return this.wrapWithCallbackLoginRequired(this.enablePushNotificationAsync,{},e)}async registerFcmTokenAsync({fcmToken:e}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:c(v.REGISTER_FCM_TOKEN),jsonData:{fcmToken:e}})}registerFcmToken(e,t){return this.wrapWithCallbackLoginRequired(this.registerFcmTokenAsync,e,t)}async registerPushKitTokenAsync({pushKitToken:e}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:c(v.REGISTER_PUSHKIT_TOKEN),jsonData:{pushKitToken:e}})}registerPushKitToken(e,t){return this.wrapWithCallbackLoginRequired(this.registerPushKitTokenAsync,e,t)}async disablePushNotificationAsync(){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:c(v.DISABLE_PUSH_NOTIFICATION)})}disablePushNotification(e){return this.wrapWithCallbackLoginRequired(this.disablePushNotificationAsync,{},e)}async logoutAsync(){if(!this.isLoggedIn())return this.clearSession(),{};const e=await l.New(this.appId).post({sessionToken:this.getSessionToken(),url:c(v.LOGOUT)});return this.clearSession(),e}logout(e){return this.wrapWithCallback(this.logoutAsync,[],e)}async getWebRTCAuthAsync(){return await l.New(this.appId).get({sessionToken:this.getSessionToken(),url:c(v.WEBRTC_AUTH)})}getWebRTCAuth(e){return this.wrapWithCallback(this.getWebRTCAuthAsync,[],e)}async getBlockedUsersAsync({lastUserId:e}){return await l.New(this.appId).get({sessionToken:this.getSessionToken(),url:c(v.BLOCKED),queries:e?{lastUserId:e}:{}})}getBlockedUsers(e,t){return this.wrapWithCallbackLoginRequired(this.getBlockedUsersAsync,e,t)}async blockUserAsync({userId:e}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:c(v.BLOCK),jsonData:{userId:e}})}blockUser(e,t){return this.wrapWithCallbackLoginRequired(this.blockUserAsync,e,t)}async unblockUserAsync({userId:e}){return await l.New(this.appId).post({sessionToken:this.getSessionToken(),url:c(v.UNBLOCK),jsonData:{userId:e}})}unblockUser(e,t){return this.wrapWithCallbackLoginRequired(this.unblockUserAsync,e,t)}async getNotificationAsync(e){const t=await l.New(this.appId).get({sessionToken:this.getSessionToken(),url:e}),{notification:s}=t;if(["message","messageDeleted"].includes(s.type))return{type:s.type,data:{channel:s.data.channel,message:s.data.message}};if(["channelAdded","channelChanged","channelRemoved"].includes(s.type))return{type:s.type,data:{channel:s.data.channel}};if(["memberAdded","memberLeft"].includes(s.type))return{type:s.type,data:{channel:s.data.channel,users:s.data.users}};if(["memberMuted","memberUnmuted"].includes(s.type))return{type:s.type,data:{channel:s.data.channel,users:s.data.users}};throw new Error(`Unsupported TalkPlus notification type: ${s.type}`)}getNotification(e,t){return this.wrapWithCallback(this.getNotificationAsync,e,t)}}var x=(n=>(n.Public="public",n.Hidden="hidden",n.Default="default",n))(x||{}),j=(n=>(n.Name="name",n))(j||{});class He extends Y{constructor(e){super();C(this,"appId","");if(!e)throw new Error("TalkPlus Channel requires appId for initialization");this.appId=e}async getListAsync(e){const{type:t,lastChannelId:s,filter:i,query:a,members:o,limit:h,category:d,subcategory:f,isFrozen:T,privateTag:k,summarize:E,order:y}=e,b=s?{lastChannelId:s}:{};return!t||!Object.values(x).includes(t)?b.type=x.Default:b.type=t,!i||!Object.values(j).includes(i)?b.filter=j.Name:b.filter=i,typeof T<"u"&&(b.isFrozen=T),a&&(b.query=a),d&&(b.category=d),f&&(b.subcategory=f),k&&(b.privateTag=k),o&&Array.isArray(o)&&o.length&&(b.members=o),E&&(b.summarize=E),y&&(b.order=y),h&&(b.limit=h),l.New(this.appId).get({sessionToken:this.getSessionToken(),url:c(p.GET_LIST),queries:b})}async getList(e,t){return this.wrapWithCallbackLoginRequired(this.getListAsync,e,t)}async createAsync({channelId:e,name:t,type:s,invitationCode:i,members:a,reuseChannel:o,imageUrl:h,maxMemberCount:d,hideMessagesBeforeJoin:f,data:T,category:k,subcategory:E}){const y={channelId:e,name:t,type:s,invitationCode:i,members:a,reuseChannel:o,imageUrl:h,maxMemberCount:d,hideMessagesBeforeJoin:f,category:k,subcategory:E};return T&&(y.data=T),l.New(this.appId).post({sessionToken:this.getSessionToken(),url:c(p.CREATE),jsonData:y})}create({channelId:e,name:t,type:s,invitationCode:i,members:a,reuseChannel:o,imageUrl:h,maxMemberCount:d,hideMessagesBeforeJoin:f,data:T,category:k,subcategory:E},y){return this.wrapWithCallbackLoginRequired(this.createAsync,{channelId:e,name:t,type:s,invitationCode:i,members:a,reuseChannel:o,imageUrl:h,maxMemberCount:d,hideMessagesBeforeJoin:f,data:T,category:k,subcategory:E},y)}getAsync({channelId:e}){return l.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.GET),e)})}async get({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.getAsync,{channelId:e},t)}async updateAsync({channelId:e,name:t,invitationCode:s,imageUrl:i,maxMemberCount:a,hideMessagesBeforeJoin:o,data:h,category:d,subcategory:f}){const T={channelId:e,name:t,invitationCode:s,imageUrl:i,maxMemberCount:a,hideMessagesBeforeJoin:o,category:d,subcategory:f};return h&&(T.data=h),l.New(this.appId).put({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.UPDATE),e),jsonData:T})}async update({channelId:e,name:t,invitationCode:s,imageUrl:i,maxMemberCount:a,hideMessagesBeforeJoin:o,data:h,category:d,subcategory:f},T){return this.wrapWithCallbackLoginRequired(this.updateAsync,{channelId:e,name:t,invitationCode:s,imageUrl:i,maxMemberCount:a,hideMessagesBeforeJoin:o,data:h,category:d,subcategory:f},T)}async deleteAsync({channelId:e}){return l.New(this.appId).delete({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.DELETE),e)})}async delete({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.deleteAsync,{channelId:e},t)}async getChannelMembersAsync({channelId:e,lastUserId:t}){const s=t?{lastUserId:t}:{};return l.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.MEMBERS),e),queries:s})}async getChannelMembers({channelId:e,lastUserId:t},s){return this.wrapWithCallbackLoginRequired(this.getChannelMembersAsync,{channelId:e,lastUserId:t},s)}async getChannelMemberAsync({channelId:e,userId:t}){return l.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.CHANNEL_MEMBER),e,t)})}async getChannelMember({channelId:e,userId:t},s){return this.wrapWithCallbackLoginRequired(this.getChannelMemberAsync,{channelId:e,userId:t},s)}async addChannelMembersAsync({channelId:e,members:t}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.ADD_MEMBERS),e),jsonData:{members:t}})}async addChannelMembers({channelId:e,members:t},s){return this.wrapWithCallbackLoginRequired(this.addChannelMembersAsync,{channelId:e,members:t},s)}async removeChannelMembersAsync({channelId:e,members:t}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.REMOVE_MEMBERS),e),jsonData:{members:t}})}async removeChannelMembers({channelId:e,members:t},s){return this.wrapWithCallbackLoginRequired(this.removeChannelMembersAsync,{channelId:e,members:t},s)}async getBannedUsersFromChannelAsync({channelId:e,lastUserId:t}){const s=t?{lastUserId:t}:{};return l.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.BANNED_USERS),e),queries:s})}async getBannedUsersFromChannel({channelId:e,lastUserId:t},s){return this.wrapWithCallbackLoginRequired(this.getBannedUsersFromChannelAsync,{channelId:e,lastUserId:t},s)}async banUsersFromChannelAsync({channelId:e,members:t}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.BAN_MEMBERS),e),jsonData:{members:t}})}async banUsersFromChannel({channelId:e,members:t},s){return this.wrapWithCallbackLoginRequired(this.banUsersFromChannelAsync,{channelId:e,members:t},s)}async unbanUsersFromChannelAsync({channelId:e,members:t}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.UNBAN_MEMBERS),e),jsonData:{members:t}})}async unbanUsersFromChannel({channelId:e,members:t},s){return this.wrapWithCallbackLoginRequired(this.unbanUsersFromChannelAsync,{channelId:e,members:t},s)}async getMutedChannelMembersAsync({channelId:e,lastUserId:t}){const s=t?{lastUserId:t}:{};return l.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.MUTED_MEMBERS),e),queries:s})}async getMutedChannelMembers({channelId:e,lastUserId:t},s){return this.wrapWithCallbackLoginRequired(this.getMutedChannelMembersAsync,{channelId:e,lastUserId:t},s)}async muteChannelMembersAsync({channelId:e,members:t,expireInMinutes:s}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.MUTE_MEMBERS),e),jsonData:{members:t,expireInMinutes:s}})}async muteChannelMembers({channelId:e,members:t,expireInMinutes:s},i){return this.wrapWithCallbackLoginRequired(this.muteChannelMembersAsync,{channelId:e,members:t,expireInMinutes:s},i)}async unmuteChannelMembersAsync({channelId:e,members:t}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.UNMUTE_MEMBERS),e),jsonData:{members:t}})}async unmuteChannelMembers({channelId:e,members:t},s){return this.wrapWithCallbackLoginRequired(this.unmuteChannelMembersAsync,{channelId:e,members:t},s)}async getMutedPeersAsync({channelId:e,lastUserId:t}){const s=t?{lastUserId:t}:{};return l.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.MUTED_PEERS),e),queries:s})}async getMutedPeers({channelId:e,lastUserId:t},s){return this.wrapWithCallbackLoginRequired(this.getMutedPeersAsync,{channelId:e,lastUserId:t},s)}async mutePeersAsync({channelId:e,members:t,expireInMinutes:s}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.MUTE_PEERS),e),jsonData:{members:t,expireInMinutes:s}})}async mutePeers({channelId:e,members:t,expireInMinutes:s},i){return this.wrapWithCallbackLoginRequired(this.mutePeersAsync,{channelId:e,members:t,expireInMinutes:s},i)}async unmutePeersAsync({channelId:e,members:t}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.UNMUTE_PEERS),e),jsonData:{members:t}})}async unmutePeers({channelId:e,members:t},s){return this.wrapWithCallbackLoginRequired(this.unmutePeersAsync,{channelId:e,members:t},s)}async enablePushNotiAsync({channelId:e}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.ENABLE_CHANNEL_PUSH_NOTI),e)})}async enablePushNoti({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.enablePushNotiAsync,{channelId:e},t)}async disablePushNotiAsync({channelId:e}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.DISABLE_CHANNEL_PUSH_NOTI),e)})}async disablePushNoti({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.disablePushNotiAsync,{channelId:e},t)}async getChannelPushNotificationSettingsAsync({channelId:e}){return l.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.CHANNEL_PUSH_NOTI_SETTINGS),e)})}async getChannelPushNotificationSettings({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.getChannelPushNotificationSettingsAsync,{channelId:e},t)}async updateChannelPushNotificationSettingsAsync({channelId:e,aosSound:t,iosSound:s}){const i={channelId:e};return t!==null&&(i.pushNotificationSoundAos=t),s!==null&&(i.pushNotificationSoundIos=s),l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.CHANNEL_PUSH_NOTI_SETTINGS),e),jsonData:i})}async updateChannelPushNotificationSettings({channelId:e,aosSound:t,iosSound:s},i){return this.wrapWithCallbackLoginRequired(this.updateChannelPushNotificationSettingsAsync,{channelId:e,aosSound:t,iosSound:s},i)}async markChannelAsReadAsync({channelId:e}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.MARK_READ),e)})}async markChannelAsRead({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.markChannelAsReadAsync,{channelId:e},t)}async markAllChannelsAsReadAsync(){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:c(p.MARK_READ_ALL)})}async markAllChannelsAsRead(e){return this.wrapWithCallbackLoginRequired(this.markAllChannelsAsReadAsync,null,e)}async getMessageAsync({channelId:e,messageId:t,translationTargetLanguage:s}){let i={sessionToken:this.getSessionToken(),url:this.sprintf(c(p.GET_MESSAGE),e,t)};return s&&(i.queries={translationTargetLanguage:s}),l.New(this.appId).get(i)}async getMessage(e,t){return this.wrapWithCallbackLoginRequired(this.getMessageAsync,e,t)}async getMessagesAsync({channelId:e,lastMessageId:t,limit:s,order:i,translationTargetLanguage:a}){const o=t?{channelId:e,lastMessageId:t}:{channelId:e};return s&&(o.limit=s),i&&(o.order=i),a&&(o.translationTargetLanguage=a),l.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.GET_MESSAGES),e),queries:o})}async getMessages(e,t){return this.wrapWithCallbackLoginRequired(this.getMessagesAsync,e,t)}async getFileMessagesAsync({channelId:e,lastMessageId:t,limit:s,order:i,translationTargetLanguage:a}){const o=t?{lastMessageId:t,channelId:e}:{channelId:e};return s&&(o.limit=s),i&&(o.order=i),a&&(o.translationTargetLanguage=a),l.New(this.appId).get({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.GET_FILE_MESSAGES),e),queries:o})}async getFileMessages(e,t){return this.wrapWithCallbackLoginRequired(this.getFileMessagesAsync,e,t)}async sendMessageAsync({channelId:e,type:t,text:s,fileUrl:i,data:a,mentions:o,translationTargetLanguages:h,file:d,parentMessageId:f}){const E={channelId:e,type:t,text:s||"",fileUrl:i||""};return a&&(E.data=a),o&&(E.mentions=o),h&&(E.translationTargetLanguages=h),f&&(E.parentMessageId=f),d?(E.file=d,l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.SEND_MESSAGE),e),formData:E})):l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.SEND_MESSAGE),e),jsonData:E})}async sendMessage({channelId:e,type:t,text:s,fileUrl:i,data:a,mentions:o,translationTargetLanguages:h,file:d,parentMessageId:f},T){return this.wrapWithCallbackLoginRequired(this.sendMessageAsync,{channelId:e,type:t,text:s,fileUrl:i,data:a,mentions:o,translationTargetLanguages:h,file:d,parentMessageId:f},T)}async translateMessageAsync({channelId:e,messageId:t,targetLanguages:s}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),jsonData:{targetLanguages:s},url:this.sprintf(c(p.TRANSLATE_MESSAGE),e,t)})}async translateMessage(e,t){return this.wrapWithCallbackLoginRequired(this.translateMessageAsync,e,t)}async deleteMessageAsync({channelId:e,messageId:t}){return l.New(this.appId).delete({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.DELETE_MESSAGE),e,t)})}async deleteMessage({channelId:e,messageId:t},s){return this.wrapWithCallbackLoginRequired(this.deleteMessageAsync,{channelId:e,messageId:t},s)}async addMessageReactionAsync({channelId:e,messageId:t,reaction:s}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.ADD_MESSAGE_REACTIONS),e,t),jsonData:{reaction:s}})}async addMessageReaction({channelId:e,messageId:t,reaction:s},i){return this.wrapWithCallbackLoginRequired(this.addMessageReactionAsync,{channelId:e,messageId:t,reaction:s},i)}async removeMessageReactionAsync({channelId:e,messageId:t,reaction:s}){return l.New(this.appId).delete({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.DELETE_MESSAGE_REACTIONS),e,t,s)})}async removeMessageReaction({channelId:e,messageId:t,reaction:s},i){return this.wrapWithCallbackLoginRequired(this.removeMessageReactionAsync,{channelId:e,messageId:t,reaction:s},i)}async updateChannelPrivateTagAsync({channelId:e,privateTag:t}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.CHANNEL_PRIVATE_TAG),e),jsonData:{privateTag:t}})}async updateChannelPrivateTag({channelId:e,privateTag:t},s){return this.wrapWithCallbackLoginRequired(this.updateChannelPrivateTagAsync,{channelId:e,privateTag:t},s)}async updateChannelPrivateDataAsync({channelId:e,privateData:t}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.CHANNEL_PRIVATE_DATA),e),jsonData:{privateData:t}})}async updateChannelPrivateData({channelId:e,privateData:t},s){return this.wrapWithCallbackLoginRequired(this.updateChannelPrivateDataAsync,{channelId:e,privateData:t},s)}async updateChannelMemberInfoAsync({channelId:e,memberInfo:t}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.CHANNEL_MEMBER_INFO),e),jsonData:{memberInfo:t}})}async updateChannelMemberInfo({channelId:e,memberInfo:t},s){return this.wrapWithCallbackLoginRequired(this.updateChannelMemberInfoAsync,{channelId:e,memberInfo:t},s)}async freezeChannelAsync({channelId:e}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.FREEZE),e)})}async freezeChannel({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.freezeChannelAsync,{channelId:e},t)}async unfreezeChannelAsync({channelId:e}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.UNFREEZE),e)})}async unfreezeChannel({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.unfreezeChannelAsync,{channelId:e},t)}async hideChannelAsync({channelId:e}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.HIDE),e)})}async hideChannel({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.hideChannelAsync,{channelId:e},t)}async showChannelAsync({channelId:e}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.SHOW),e)})}async showChannel({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.showChannelAsync,{channelId:e},t)}async hideAllChannelsAsync(){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:c(p.HIDE_ALL)})}async hideAllChannels(e){return this.wrapWithCallbackLoginRequired(this.hideAllChannelsAsync,null,e)}async joinChannelAsync({channelId:e}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.JOIN),e)})}async joinChannel({channelId:e},t){return this.wrapWithCallbackLoginRequired(this.joinChannelAsync,{channelId:e},t)}async joinChannelByInvitationCodeAsync({channelId:e,invitationCode:t}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.JOIN_INVITATION),e),jsonData:{invitationCode:t}})}async joinChannelByInvitationCode({channelId:e,invitationCode:t},s){return this.wrapWithCallbackLoginRequired(this.joinChannelByInvitationCodeAsync,{channelId:e,invitationCode:t},s)}async leaveChannelAsync({channelId:e,deleteChannelIfEmpty:t}){const s={channelId:e,deleteChannelIfEmpty:t};return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.LEAVE),e),jsonData:s})}async leaveChannel({channelId:e,deleteChannelIfEmpty:t},s){return this.wrapWithCallbackLoginRequired(this.leaveChannelAsync,{channelId:e,deleteChannelIfEmpty:t},s)}async getUnreadCountAsync(){return l.New(this.appId).get({sessionToken:this.getSessionToken(),url:c(p.UNREAD_COUNT)})}async getUnreadCount(e){return this.wrapWithCallbackLoginRequired(this.getUnreadCountAsync,null,e)}async transferChannelOwnershipAsync({channelId:e,userId:t}){return l.New(this.appId).post({sessionToken:this.getSessionToken(),url:this.sprintf(c(p.TRANSFER_OWNERSHIP),e),jsonData:{userId:t}})}async transferChannelOwnership({channelId:e,userId:t},s){return this.wrapWithCallbackLoginRequired(this.transferChannelOwnershipAsync,{channelId:e,userId:t},s)}getMessageUnreadCount({channel:e,message:t}){if(!this.userId)throw new Error("TalkPlus user not logged in");let s=0;return(e.members||[]).forEach(i=>{this.userId!==i.id&&i.lastReadAt<t.createdAt&&s++}),s}sprintf(e,...t){let s=e;return t.forEach(i=>{s=s.replace("%s",i)}),s}}var ye=(n=>(n.Private="private",n.Public="public",n.InvitationOnly="invitationOnly",n.Broadcast="broadcast",n.SuperPublic="super_public",n.SuperPrivate="super_private",n.SuperBroadcast="super_broadcast",n.Brand="brand",n))(ye||{}),ge=(n=>(n.Text="text",n.Hidden="hidden",n.Admin="admin",n.AdminHidden="admin_hidden",n.Custom="custom",n.Brand="brand",n))(ge||{}),Ce=(n=>(n.ChannelAdded="channelAdded",n.ChannelRemoved="channelRemoved",n.ChannelChanged="channelChanged",n.MemberAdded="memberAdded",n.MemberLeft="memberLeft",n.MemberMuted="memberMuted",n.MemberUnmuted="memberUnmuted",n.MemberBanned="memberBanned",n.MemberUnbanned="memberUnbanned",n.Message="message",n.MessageDeleted="messageDeleted",n))(Ce||{}),S=(n=>(n.Offer="offer",n.Answer="answer",n.Candidate="candidate",n.EndCall="endCall",n))(S||{}),R=(n=>(n[n.Unknown=0]="Unknown",n[n.Completed=1]="Completed",n[n.Declined=2]="Declined",n[n.Canceled=3]="Canceled",n))(R||{}),M=(n=>(n.Unknown="unknown",n.Completed="completed",n.Declined="declined",n.Canceled="canceled",n))(M||{});const qe=3e4;class Ge extends Y{constructor({appId:e,disableEvents:t}){super();C(this,"appId","");C(this,"disableEvents",!1);C(this,"deviceId","");C(this,"auth");C(this,"channel");C(this,"latestNotiTimestamp",0);C(this,"lastExponentialBackOffInMS",1);C(this,"wsConn");C(this,"rtcPeerConn");C(this,"rtcPeerUuid");C(this,"rtcPeerChannelId");C(this,"rtcPeerCallerId");C(this,"rtcPeerCalleeId");C(this,"rtcPeerIncomingOfferPayload");C(this,"rtcPeerIncomingCustomData");C(this,"rtcPeerConnectionInProgress",!1);C(this,"rtcPeerConnectionMade",!1);C(this,"rtcPeerIceCandidates");C(this,"publicChannelsEventListener");C(this,"call");if(!e)throw new Error("TalkPlus Client requires appId for initialization");this.appId=e,this.deviceId=this.generateDeviceId(),this.disableEvents=t||!1,this.auth=new $e(e),this.channel=new He(e),this.publicChannelsEventListener=new pe,this.call=new pe}getVersion(){return Z}updateSession(e){if(this.clearSession(),super.updateSession(e),this.auth.updateSession(e),this.channel.updateSession(e),!this.disableEvents){const t={appId:this.appId,sessionId:this.sessionId,sessionToken:this.sessionToken};this.startWebSocketConn(t)}}startWebSocketConn({appId:e,sessionId:t,sessionToken:s}){let i=xe(v.WEBSOCKET_NOTIFICATIONS);this.latestNotiTimestamp&&(i+=`?timestamp=${this.latestNotiTimestamp}`),this.wsConn=new WebSocket(i),this.wsConn.onopen=a=>{var h;const o=JSON.stringify({appId:e,sessionId:t,sessionToken:s});(h=this.wsConn)==null||h.send(o)},this.wsConn.onclose=a=>{this.lastExponentialBackOffInMS>=qe?this.lastExponentialBackOffInMS=10:this.lastExponentialBackOffInMS>1e4?this.lastExponentialBackOffInMS+=3e3:this.lastExponentialBackOffInMS+=1e3;const o={appId:this.appId,sessionId:this.sessionId,sessionToken:this.sessionToken};this.wsConn.wsConnTimer=setTimeout(()=>this.startWebSocketConn(o),this.lastExponentialBackOffInMS)},this.wsConn.onmessage=this.websocketNotificationHandler.bind(this)}websocketNotificationHandler(e){let t;try{t=JSON.parse(e.data)}catch(d){console.error(d);return}const{error:s,type:i,data:a}=t,o=i?i.toLowerCase():"";this.latestNotiTimestamp=t.timestamp;const h=Object.values(S).includes(i);try{if(s)this.handleError(t);else if(h)switch(i){case S.Candidate:this.handleWebRTCIceCandidate(a.webRtc);break;case S.Offer:this.handleWebRTCOffer(a.webRtc);break;case S.Answer:this.handleWebRTCAnswer(a.webRtc);break;case S.EndCall:this.handleWebRTCEndCall(a.webRtc);break}else a.isPublicChannelEvent?(this.publicChannelsEventListener.emit("event",a),this.publicChannelsEventListener.emit(o,a)):(this.emit("event",a),this.emit(o,a))}catch{}}handleError(e){this.rtcPeerConnectionMade=!1,this.call.emit("error",{channelId:this.rtcPeerChannelId,callerId:this.rtcPeerCallerId,calleeId:this.rtcPeerCalleeId,error:e}),this.resetWebRTCDetails()}clearSession(){super.clearSession(),this.auth.clearSession(),this.channel.clearSession(),this.wsConn&&(clearInterval(this.wsConn.wsConnTimer),this.wsConn.close()),this.resetWebRTCDetails()}getNotification(e){let t=e.talkplus;return typeof t=="string"&&(t=JSON.parse(t)),this.auth.getNotification(t.notificationLink)}loginWithToken(e,t){return e.file&&(e.profileImageUrl=void 0),this.auth.loginWithToken(this.deviceId,e,[this],t)}loginAnonymous(e,t){return e.file&&(e.profileImageUrl=void 0),this.auth.loginAnonymous(this.deviceId,e,[this],t)}updateUser(e,t){return e.file&&(e.profileImageUrl=void 0),this.auth.updateUser(e,t)}deleteUser(e){const t=this.auth.deleteUser(e);return this.clearSession(),t}registerFcmToken(e,t){return this.auth.registerFcmToken(e,t)}registerPushKitToken(e,t){return this.auth.registerPushKitToken(e,t)}enablePushNotification(e){return this.auth.enablePushNotification(e)}disablePushNotification(e){return this.auth.disablePushNotification(e)}logout(e){const t=this.auth.logout(e);return this.clearSession(),t}getBlockedUsers(e,t){return this.auth.getBlockedUsers(e,t)}blockUser(e,t){return this.auth.blockUser(e,t)}unblockUser(e,t){return this.auth.unblockUser(e,t)}getChannels(e,t){return this.channel.getList(e,t)}searchChannels(e,t){const{query:s,members:i}=e;if(!s&&(!Array.isArray(i)||!i.length))throw new Error("Searching channels requires either a non-empty query or a list of member IDs to match");return e.filter=j.Name,this.channel.getList(e,t)}getHiddenChannels(e,t){return e.type=x.Hidden,this.channel.getList(e,t)}getPublicChannels(e,t){return e.type=x.Public,this.channel.getList(e,t)}createChannel(e,t){return this.channel.create(e,t)}getChannel(e,t){return this.channel.get(e,t)}updateChannel(e,t){return this.channel.update(e,t)}deleteChannel(e,t){return this.channel.delete(e,t)}getChannelMembers(e,t){return this.channel.getChannelMembers(e,t)}getChannelMember(e,t){return this.channel.getChannelMember(e,t)}addChannelMembers(e,t){return this.channel.addChannelMembers(e,t)}removeChannelMembers(e,t){return this.channel.removeChannelMembers(e,t)}getBannedUsersFromChannel(e,t){return this.channel.getBannedUsersFromChannel(e,t)}getBannedChannelUsers(e,t){return this.channel.getBannedUsersFromChannel(e,t)}banUsersFromChannel(e,t){return this.channel.banUsersFromChannel(e,t)}banChannelMembers(e,t){return this.channel.banUsersFromChannel(e,t)}unbanUsersFromChannel(e,t){return this.channel.unbanUsersFromChannel(e,t)}unbanChannelMembers(e,t){return this.channel.unbanUsersFromChannel(e,t)}getMutedChannelMembers(e,t){return this.channel.getMutedChannelMembers(e,t)}muteChannelMembers(e,t){return this.channel.muteChannelMembers(e,t)}unmuteChannelMembers(e,t){return this.channel.unmuteChannelMembers(e,t)}getMutedPeers(e,t){return this.channel.getMutedPeers(e,t)}mutePeers(e,t){return this.channel.mutePeers(e,t)}unmutePeers(e,t){return this.channel.unmutePeers(e,t)}enableChannelPushNotification(e,t){return this.channel.enablePushNoti(e,t)}disableChannelPushNotification(e,t){return this.channel.disablePushNoti(e,t)}getChannelPushNotificationSettings(e,t){return this.channel.getChannelPushNotificationSettings(e,t)}updateChannelPushNotificationSettings(e,t){return this.channel.updateChannelPushNotificationSettings(e,t)}markChannelAsRead(e,t){return this.channel.markChannelAsRead(e,t)}markAsRead(e,t){return this.channel.markChannelAsRead(e,t)}markAllChannelsAsRead(e){return this.channel.markAllChannelsAsRead(e)}markAsReadAllChannel(e){return this.channel.markAllChannelsAsRead(e)}getMessages(e,t){return this.channel.getMessages(e,t)}getFileMessages(e,t){return this.channel.getFileMessages(e,t)}sendMessage(e,t){return this.channel.sendMessage(e,t)}translateMessage(e,t){return this.channel.translateMessage(e,t)}getMessage(e,t){return this.channel.getMessage(e,t)}deleteMessage(e,t){return this.channel.deleteMessage(e,t)}addMessageReaction(e,t){return this.channel.addMessageReaction(e,t)}removeMessageReaction(e,t){return this.channel.removeMessageReaction(e,t)}updateChannelPrivateTag(e,t){return this.channel.updateChannelPrivateTag(e,t)}updateChannelPrivateData(e,t){return this.channel.updateChannelPrivateData(e,t)}updateChannelMemberInfo(e,t){return this.channel.updateChannelMemberInfo(e,t)}freezeChannel(e,t){return this.channel.freezeChannel(e,t)}unfreezeChannel(e,t){return this.channel.unfreezeChannel(e,t)}hideChannel(e,t){return this.channel.hideChannel(e,t)}showChannel(e,t){return this.channel.showChannel(e,t)}hideAllChannels(e){return this.channel.hideAllChannels(e)}joinChannel(e,t){return this.channel.joinChannel(e,t)}joinChannelByInvitationCode(e,t){return this.channel.joinChannelByInvitationCode(e,t)}leaveChannel(e,t){return this.channel.leaveChannel(e,t)}getUnreadCount(e){return this.channel.getUnreadCount(e)}transferChannelOwnership(e,t){return this.channel.transferChannelOwnership(e,t)}getMessageUnreadCount(e){return this.channel.getMessageUnreadCount(e)}async makeCall(e,t){if(!e.channelId)throw Error("MissingChannelId");if(!e.calleeId)throw Error("MissingCalleeId");if(this.isInCall()&&this.endCurrentCallIfAny(),this.rtcPeerUuid=crypto.randomUUID(),this.rtcPeerChannelId=e.channelId,this.rtcPeerCallerId=this.userId,this.rtcPeerCalleeId=e.calleeId,await this.createRtcPeerConn(),e.mediaStream)await this.addTracksFromMediaStream(e.mediaStream);else{const i=await this.createMediaStreamFromConstraints(e.constraints);await this.addTracksFromMediaStream(i)}this.__makeOffer(e.customData);const s={channelId:this.rtcPeerChannelId,callerId:this.rtcPeerCallerId,calleeId:this.rtcPeerCalleeId};return t?t(s):s}isInCall(){return!!this.rtcPeerUuid&&!!this.rtcPeerChannelId}async createMediaStreamFromConstraints(e){let t;return e?t=await navigator.mediaDevices.getUserMedia(e):t=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),t}__makeOffer(e){var i;const t=this.wsConn,s=this.rtcPeerConn;(i=this.rtcPeerConn)==null||i.createOffer({iceRestart:!0,offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(a=>{s==null||s.setLocalDescription(a).then(()=>{const o=JSON.stringify({type:S.Offer,uuid:this.rtcPeerUuid,channelId:this.rtcPeerChannelId,callerId:this.rtcPeerCallerId,calleeId:this.rtcPeerCalleeId,payload:a,customData:e});this.__sendWs(t,o)}).catch(o=>{})}).catch(a=>{console.error(a)})}async addTracksFromMediaStream(e){var s;const t=e==null?void 0:e.getTracks();if(t.length&&!(!this.rtcPeerConn||this.rtcPeerConn.connectionState==="closed"))for(const i of t)(s=this.rtcPeerConn)==null||s.addTrack(i,e)}async createRtcPeerConn(){let e;try{e=await this.auth.getWebRTCAuth()}catch{return}const{stunServerUris:t,turnServerUris:s,turnUsername:i,turnPassword:a}=e,o=[];for(const h of t)o.push({urls:h});for(const h of s)o.push({urls:h,username:i,credential:a});this.rtcPeerConn=new RTCPeerConnection({iceServers:o}),!(!this.rtcPeerChannelId||!this.rtcPeerCalleeId)&&(this.rtcPeerConn.onnegotiationneeded=h=>{this.rtcPeerIncomingOfferPayload||this.__makeOffer()},this.rtcPeerConn.onicecandidate=h=>{var f;if(!h.candidate)return;if(!this.rtcPeerConnectionInProgress){(f=this.rtcPeerIceCandidates)==null||f.push(h.candidate);return}const d=JSON.stringify({type:S.Candidate,uuid:this.rtcPeerUuid,channelId:this.rtcPeerChannelId,callerId:this.rtcPeerCallerId,calleeId:this.rtcPeerCalleeId,payload:h.candidate});this.__sendWs(this.wsConn,d)},this.rtcPeerConn.onconnectionstatechange=h=>{var d,f;this.call.emit("statechanged",{channelId:this.rtcPeerChannelId,callerId:this.rtcPeerCallerId,calleeId:this.rtcPeerCalleeId,state:(d=h.currentTarget)==null?void 0:d.connectionState}),((f=h.currentTarget)==null?void 0:f.connectionState)==="failed"&&(this.call.emit("failed",{channelId:this.rtcPeerChannelId,callerId:this.rtcPeerCallerId,calleeId:this.rtcPeerCalleeId}),this.resetWebRTCDetails())},this.rtcPeerConn.ontrack=h=>{this.rtcPeerConnectionMade=!0,this.call.emit("connected",{channelId:this.rtcPeerChannelId,callerId:this.rtcPeerCallerId,calleeId:this.rtcPeerCalleeId,trackEvent:h,customData:this.rtcPeerIncomingCustomData})})}handleWebRTCIceCandidate(e){var i;if(e.uuid!==this.rtcPeerUuid)return;const t=e.payload;if(!this.rtcPeerConn){console.error("rtc peer conn not available");return}const s=new RTCIceCandidate(t);(i=this.rtcPeerConn)==null||i.addIceCandidate(s).then(()=>{}).catch(a=>{})}endCurrentCallIfAny(){if(this.isInCall()){const e=JSON.stringify({type:S.EndCall,uuid:this.rtcPeerUuid,channelId:this.rtcPeerChannelId,callerId:this.rtcPeerCallerId,calleeId:this.rtcPeerCalleeId,endReasonCode:R.Declined,endReasonMessage:M.Declined});this.__sendWs(this.wsConn,e)}}async handleWebRTCOffer(e){if(this.isInCall()){this.endCurrentCallIfAny();return}const{uuid:t,channelId:s,callerId:i,calleeId:a,payload:o,customData:h}=e;this.rtcPeerUuid=t,this.rtcPeerChannelId=s,this.rtcPeerCallerId=i,this.rtcPeerCalleeId=a,this.rtcPeerIncomingOfferPayload=o,await this.createRtcPeerConn(),this.call.emit("incoming",{channelId:s,callerId:i,calleeId:a,customData:h})}async acceptCall(e,t){var i;if(!this.rtcPeerIncomingOfferPayload)throw Error("NoCallToReceive");if(e.mediaStream)await this.addTracksFromMediaStream(e.mediaStream);else{const a=await this.createMediaStreamFromConstraints(e.constraints);await this.addTracksFromMediaStream(a)}await((i=this.rtcPeerConn)==null?void 0:i.setRemoteDescription(new RTCSessionDescription(this.rtcPeerIncomingOfferPayload))),await this.sendAnswer(e.customData),this.rtcPeerConnectionInProgress=!0,this.sendSavedIceCandidates();const s={channelId:this.rtcPeerChannelId||"",callerId:this.rtcPeerCallerId||"",calleeId:this.rtcPeerCalleeId||""};return t?t(s):s}async sendAnswer(e){var i,a;const t=await((i=this.rtcPeerConn)==null?void 0:i.createAnswer());if(!t){console.error("TalkPlus client. unable to create peer answer");return}(a=this.rtcPeerConn)==null||a.setLocalDescription(new RTCSessionDescription(t)).catch(o=>{console.error(o)});const s=JSON.stringify({type:S.Answer,uuid:this.rtcPeerUuid,channelId:this.rtcPeerChannelId,callerId:this.rtcPeerCallerId,calleeId:this.rtcPeerCalleeId,payload:t,customData:e});this.__sendWs(this.wsConn,s)}endCall(e){if(!this.rtcPeerUuid)throw new Error("NoCallInProgress");let t={channelId:this.rtcPeerChannelId,callerId:this.rtcPeerCallerId,calleeId:this.rtcPeerCalleeId,endReasonCode:R.Completed,endReasonMessage:M.Completed},s={type:S.EndCall,uuid:this.rtcPeerUuid,channelId:this.rtcPeerChannelId,callerId:this.rtcPeerCallerId,calleeId:this.rtcPeerCalleeId,endReasonCode:R.Completed,endReasonMessage:M.Completed};this.rtcPeerIncomingOfferPayload&&!this.rtcPeerConnectionMade?(s.endReasonCode=R.Declined,s.endReasonMessage=M.Declined,t.endReasonCode=R.Declined,t.endReasonMessage=M.Declined):this.rtcPeerConnectionMade||(s.endReasonCode=R.Canceled,s.endReasonMessage=M.Canceled,t.endReasonCode=R.Canceled,t.endReasonMessage=M.Canceled),this.__sendWs(this.wsConn,JSON.stringify(s));const i={channelId:this.rtcPeerChannelId||"",callerId:this.rtcPeerCallerId||"",calleeId:this.rtcPeerCalleeId||""};return this.handleCallEndedEvent(t),e?e(i):i}__sendWs(e,t){try{e==null||e.send(t)}catch{}}handleWebRTCAnswer(e){var s;if(e.uuid!==this.rtcPeerUuid){const i=JSON.stringify({type:S.EndCall,uuid:e.uuid,channelId:e.channelId,callerId:e.callerId,calleeId:e.calleeId,endReasonCode:R.Canceled,endReasonMessage:M.Canceled});this.__sendWs(this.wsConn,i);return}this.rtcPeerConnectionInProgress=!0,this.sendSavedIceCandidates(),this.rtcPeerIncomingCustomData=e.customData;const t=e.payload;(s=this.rtcPeerConn)==null||s.setRemoteDescription(new RTCSessionDescription(t)).then(()=>{})}sendSavedIceCandidates(){if(this.rtcPeerIceCandidates){for(const e of this.rtcPeerIceCandidates){const t=JSON.stringify({type:S.Candidate,uuid:this.rtcPeerUuid,channelId:this.rtcPeerChannelId,callerId:this.rtcPeerCallerId,calleeId:this.rtcPeerCalleeId,payload:e});this.__sendWs(this.wsConn,t)}this.rtcPeerIceCandidates=[]}}handleWebRTCEndCall(e){if(!this.rtcPeerUuid||this.rtcPeerUuid!==e.uuid)return;const t={channelId:e.channelId,callerId:e.callerId,calleeId:e.calleeId,endReasonCode:e.endReasonCode,endReasonMessage:e.endReasonMessage};this.handleCallEndedEvent(t)}handleCallEndedEvent(e){this.call.emit("ended",e),this.resetWebRTCDetails()}resetWebRTCDetails(){var e;(e=this.rtcPeerConn)==null||e.close(),this.rtcPeerUuid=void 0,this.rtcPeerChannelId=void 0,this.rtcPeerCallerId=void 0,this.rtcPeerCalleeId=void 0,this.rtcPeerIncomingOfferPayload=void 0,this.rtcPeerIncomingCustomData=void 0,this.rtcPeerConnectionInProgress=!1,this.rtcPeerConnectionMade=!1,this.rtcPeerIceCandidates=[]}}I.ChannelQueryFilterEnum=j,I.ChannelQueryTypeEnum=x,I.ChannelTypeEnum=ye,I.Client=Ge,I.EventTypeEnum=Ce,I.MessageTypeEnum=ge,I.WebRTCEndCallReasonEnum=R,I.WebRTCEndCallReasonMsgEnum=M,I.WebRTCEventTypeEnum=S,Object.defineProperty(I,Symbol.toStringTag,{value:"Module"})});
